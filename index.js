var _0x21b5=["\x63\x6F\x6E\x66\x69\x67","\x64\x6F\x74\x65\x6E\x76","\x6D\x6F\x6D\x65\x6E\x74","\x66\x73","\x6D\x6B\x64\x69\x72\x70","\x64\x61\x74\x65\x66\x6F\x72\x6D\x61\x74","\x45\x78\x70\x6F\x72\x74\x54\x6F\x43\x73\x76","\x65\x78\x70\x6F\x72\x74\x2D\x74\x6F\x2D\x63\x73\x76","\x6D\x6F\x6E\x67\x6F\x6F\x73\x65","\x6D\x73\x73\x71\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x72\x61\x77\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x63\x61\x6C\x63\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x65\x6E\x76","\x63\x6F\x6E\x6E\x65\x63\x74","\x75\x73\x65\x46\x69\x6E\x64\x41\x6E\x64\x4D\x6F\x64\x69\x66\x79","\x73\x65\x74","\x2E\x2F\x63\x6F\x6E\x66\x69\x67\x2F\x73\x71\x6C\x2E\x6A\x73","\x6E\x6F\x64\x65\x2D\x6F\x70\x63\x75\x61\x2D\x63\x6C\x69\x65\x6E\x74","\x46\x4C\x45\x58\x59\x5F\x4E\x61\x6D\x65\x73\x70\x61\x63\x65","\x73\x69\x74\x65\x5F\x69\x64","\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65","\x75\x73\x65\x72\x2F\x65\x64\x69\x74\x2E\x74\x78\x74","\x72\x65\x61\x64\x46\x69\x6C\x65\x53\x79\x6E\x63","\x70\x61\x72\x73\x65","\x76\x61\x6C\x75\x65","\x64\x61\x74\x61","\x74\x69\x65\x72\x31","\x74\x69\x65\x72\x32","\x61\x76\x72\x54\x69\x65\x72\x31","\x61\x76\x72\x54\x69\x65\x72\x32","\x75\x73\x65\x72\x20\x6D\x6F\x64\x69\x66\x69\x65\x64\x20","\x6C\x6F\x67","\x7B\x22\x74\x69\x65\x72\x31\x22\x3A\x20\x30\x2C\x20\x22\x74\x69\x65\x72\x32\x22\x3A\x20\x30\x2C\x20\x22\x61\x76\x72\x54\x69\x65\x72\x31\x22\x3A\x20\x30\x2C\x20\x22\x61\x76\x72\x54\x69\x65\x72\x32\x22\x3A\x30\x20\x7D","\x77\x72\x69\x74\x65\x46\x69\x6C\x65\x53\x79\x6E\x63","\x75\x73\x65\x72\x20\x6D\x6F\x64\x69\x66\x69\x65\x64","\x6D\x69\x6E\x75\x74\x65\x73","\x73\x75\x62\x74\x72\x61\x63\x74","\x75\x70\x64\x61\x74\x65\x4D\x61\x6E\x79","\x69\x6E\x73\x65\x72\x74\x4D\x61\x6E\x79","\x73\x74\x72\x69\x6E\x67\x69\x66\x79","\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74","\x6E\x6F\x74\x65","","\x6D\x6D\x2F\x64\x64\x2F\x79\x79\x79\x79\x20\x48\x48\x3A\x4D\x4D","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x51\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x51\x2D\x47\x4E\x32\x32","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x50\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x54\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x43\x4F\x4D\x4D\x55\x4E\x49\x43\x41\x54\x49\x4F\x4E","\x45\x72\x72\x6F\x72\x20\x73\x61\x76\x65\x20\x64\x61\x74\x61\x20\x74\x6F\x20\x4C\x6F\x63\x61\x6C\x20\x64\x61\x74\x61","\x66\x69\x6E\x64","\x63\x6F\x75\x6E\x74\x44\x6F\x63\x75\x6D\x65\x6E\x74\x73","\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E","\x66\x6F\x72\x45\x61\x63\x68","\x61\x76\x72\x46\x6C\x6F\x77","\x61\x76\x72\x5F\x66\x6C\x6F\x77","\x64\x61\x79\x73","\x64\x65\x6C\x65\x74\x65\x4D\x61\x6E\x79","\x44\x65\x6C\x65\x74\x65\x64\x20\x64\x61\x74\x61\x20\x62\x65\x66\x6F\x72\x65\x20","\x54\x6F\x74\x61\x6C\x20\x72\x65\x63\x6F\x72\x64\x20\x64\x65\x6C\x65\x74\x65\x64\x20\x3D\x20","\x64\x65\x6C\x65\x74\x65\x64\x43\x6F\x75\x6E\x74","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x31","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x32","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x33","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x34","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x35","\x66\x6F\x72\x6D\x61\x74","\x6C\x6F\x63\x61\x6C","\x70\x75\x73\x68","\x69\x70","\x70\x6F\x72\x74","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x55\x53\x45\x52\x4E\x41\x4D\x45","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x50\x41\x53\x53\x57\x4F\x52\x44","\x6C\x69\x6D\x69\x74","\x73\x6F\x72\x74","\x66\x69\x6E\x64\x4F\x6E\x65","\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A","\x46\x69\x72\x73\x74\x20\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x20","\x69\x6E\x70\x75\x74","\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65","\x70\x72\x65\x73\x73\x75\x72\x65","\x66\x6C\x6F\x77","\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65\x2C\x20\x70\x72\x65\x73\x73\x75\x72\x65\x2C\x20\x66\x6C\x6F\x77\x2C\x20\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77\x2C","\x20\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x29\x20\x56\x41\x4C\x55\x45\x53\x20","\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65\x2C\x40\x70\x72\x65\x73\x73\x75\x72\x65\x2C\x20\x40\x66\x6C\x6F\x77\x2C\x20\x40\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77\x2C\x20\x40\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x29","\x71\x75\x65\x72\x79","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x32\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x61\x76\x72\x66\x6C\x6F\x77\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x61\x76\x72\x46\x6C\x6F\x77\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29","\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x53\x74\x61\x74\x75\x73\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29","\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x32\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x53\x74\x61\x74\x75\x73\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x65\x6C\x65\x74\x65\x64\x20\x64\x61\x74\x61\x20\x62\x65\x66\x6F\x72\x65\x20\x31\x30\x20\x64\x61\x79\x73","\x65\x72\x72\x6F\x72","\x53\x51\x4C\x20\x68\x61\x73\x20\x69\x73\x73\x75\x65\x20","\x6F\x6E","\x63\x72\x65\x61\x74\x65","\x62\x61\x63\x6B\x6F\x66\x66","\x42\x61\x63\x6B\x6F\x66\x66\x20","\x20\x6E\x65\x78\x74\x20\x61\x74\x74\x65\x6D\x70\x74\x20\x69\x6E\x20","\x6D\x73","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x6C\x6F\x73\x74","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x6C\x6F\x73\x74","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x72\x65\x65\x73\x74\x61\x62\x6C\x69\x73\x68\x65\x64","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x72\x65\x2D\x65\x73\x74\x61\x62\x6C\x69\x73\x68\x65\x64","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x66\x61\x69\x6C\x65\x64","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x66\x61\x69\x6C\x65\x64","\x73\x74\x61\x72\x74\x5F\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x53\x74\x61\x72\x74\x69\x6E\x67\x20\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x61\x66\x74\x65\x72\x5F\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x41\x66\x74\x65\x72\x20\x52\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x65\x76\x65\x6E\x74\x20\x3D\x3E","\x75\x73\x65\x72\x6E\x61\x6D\x65","\x70\x61\x73\x73\x77\x6F\x72\x64","\x63\x72\x65\x61\x74\x65\x53\x65\x73\x73\x69\x6F\x6E","\x63\x72\x65\x61\x74\x65\x53\x75\x62\x73\x63\x72\x69\x70\x74\x69\x6F\x6E\x32","\x73\x74\x61\x72\x74\x65\x64","\x6E\x73\x3D","\x3B\x73\x3D","\x6E\x61\x6D\x65","\x56\x61\x6C\x75\x65","\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64","\x4F\x50\x43\x20\x55\x41\x20\x49\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64\x21\x20\x43\x6F\x6E\x6E\x65\x63\x74\x20\x74\x6F\x20\x46\x6C\x65\x78\x79\x20\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6C\x6C\x79","\x63\x68\x61\x6E\x67\x65\x64","\x6E\x6F\x64\x65\x49\x64","\x69\x74\x65\x6D\x54\x6F\x4D\x6F\x6E\x69\x74\x6F\x72","\x73\x65\x72\x76\x65\x72\x54\x69\x6D\x65\x73\x74\x61\x6D\x70","\x66\x69\x6E\x64\x49\x6E\x64\x65\x78","\x74\x6F\x46\x69\x78\x65\x64","\x74\x69\x6D\x65","\x74\x65\x72\x6D\x69\x6E\x61\x74\x65","\x63\x6C\x6F\x73\x65","\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74","\x44\x6F\x6E\x65\x20\x21","\x45\x72\x72\x6F\x72","\x2C","\x2E","\x5B\x44\x61\x74\x61\x5D","\x54\x69\x6D\x65\x53\x74\x61\x6D\x70","\x54\x61\x67\x6E\x61\x6D\x65","\x67\x65\x6E\x65\x72\x61\x74\x65\x43\x73\x76","\x59\x59\x59\x59\x4D\x4D\x44\x44\x5F\x48\x48\x6D\x6D\x73\x73","\x43\x53\x56\x5F\x45\x58\x50\x4F\x52\x54\x5F\x50\x41\x54\x48","\x5C\x44\x61\x74\x61\x5F","\x5F","\x2E\x63\x73\x76","\x43\x53\x56\x5F\x42\x41\x43\x4B\x55\x50\x5F\x50\x41\x54\x48","\x5C","\x59\x59\x59\x59","\x59\x59\x59\x59\x5F\x4D\x4D","\x59\x59\x59\x59\x5F\x4D\x4D\x5F\x44\x44","\x59\x59\x59\x59\x5F\x4D\x4D\x5F\x44\x44\x5F\x48\x48","\x73\x79\x6E\x63"];require(_0x21b5[1])[_0x21b5[0]]();var moment=require(_0x21b5[2]);var fs=require(_0x21b5[3]);const mkdirp=require(_0x21b5[4]);var dateFormat=require(_0x21b5[5]);const ExportToCsv=require(_0x21b5[7])[_0x21b5[6]];var mongoose=require(_0x21b5[8]);var sql=require(_0x21b5[9]);var RawData=require(_0x21b5[10]);var CalcData=require(_0x21b5[11]);mongoose[_0x21b5[13]](process[_0x21b5[12]].MONGO_URL,{useNewUrlParser:true,useUnifiedTopology:true});mongoose[_0x21b5[15]](_0x21b5[14],false);const sqlConfig=require(_0x21b5[16]);const {OPCUAClient,resolveNodeId,AttributeIds,ClientMonitoredItemGroup,TimestampsToReturn}=require(_0x21b5[17]);let TIER_2_BENCHMARK=parseFloat(process[_0x21b5[12]].TIER_2_BENCHMARK);let TIME_INTERVAL_GETDATA=parseInt(process[_0x21b5[12]].TIME_INTERVAL_GETDATA)* 1000;let TIME_INTERVAL_CALCDATA=parseInt(process[_0x21b5[12]].TIME_INTERVAL_CALCDATA)* 1000;let TIME_INTERVAL_REMOVE_DATA=parseInt(process[_0x21b5[12]].TIME_INTERVAL_REMOVE_DATA)* 86400000;let flexy_ns=process[_0x21b5[12]][_0x21b5[18]];var opc_server=[];var opc_server_avr=[];var interval_flag=0;async function run(){ await readFirstConfig(); await setTimeout(function(){},2000); await setInterval(async function(){let _0xa2ffx14=opc_server[0][_0x21b5[19]];let _0xa2ffx15=opc_server[0][_0x21b5[20]];if(interval_flag){const _0xa2ffx16= await fs[_0x21b5[22]](_0x21b5[21]);let _0xa2ffx17=_0xa2ffx16.toString();let _0xa2ffx18=JSON[_0x21b5[23]](_0xa2ffx17);let _0xa2ffx19=opc_server[0][_0x21b5[25]][3][_0x21b5[24]];let _0xa2ffx1a=opc_server[0][_0x21b5[26]];let _0xa2ffx1b=opc_server[0][_0x21b5[27]];if(_0xa2ffx18[_0x21b5[26]]> 0|| _0xa2ffx18[_0x21b5[27]]> 0|| _0xa2ffx18[_0x21b5[28]]> 0|| _0xa2ffx18[_0x21b5[29]]> 0){console[_0x21b5[31]](_0x21b5[30],_0xa2ffx18[_0x21b5[26]],_0xa2ffx18[_0x21b5[27]],_0xa2ffx18[_0x21b5[28]],_0xa2ffx18[_0x21b5[29]]);fs[_0x21b5[33]](_0x21b5[21],_0x21b5[32]);_0xa2ffx1a= _0xa2ffx18[_0x21b5[26]];_0xa2ffx1b= _0xa2ffx18[_0x21b5[27]];let _0xa2ffx1c={site_id:opc_server[0][_0x21b5[19]],site_name:opc_server[0][_0x21b5[20]],information:opc_server[0][_0x21b5[25]],tier1:_0xa2ffx18[_0x21b5[26]],tier2:_0xa2ffx18[_0x21b5[27]],created_at: new Date(),flag:1,note:_0x21b5[34]};let _0xa2ffx1d=moment()[_0x21b5[36]](20,_0x21b5[35]);let _0xa2ffx1e=moment();let _0xa2ffx1f={created_at:{$gte:_0xa2ffx1d},tier1:{$gt:0}}; await RawData[_0x21b5[37]](_0xa2ffx1f,{$set:{flag:0}}); await RawData[_0x21b5[38]](_0xa2ffx1c);insert_data(_0xa2ffx14,_0xa2ffx15,opc_server[0][_0x21b5[25]][0][_0x21b5[24]],opc_server[0][_0x21b5[25]][2][_0x21b5[24]],opc_server[0][_0x21b5[25]][1][_0x21b5[24]],opc_server[0][_0x21b5[25]][3][_0x21b5[24]],JSON[_0x21b5[39]](opc_server[0][_0x21b5[25]]),_0xa2ffx18[_0x21b5[26]],_0xa2ffx18[_0x21b5[27]],opc_server[0][_0x21b5[40]]);opc_server_avr[_0x21b5[26]]= _0xa2ffx18[_0x21b5[28]];opc_server_avr[_0x21b5[27]]= _0xa2ffx18[_0x21b5[29]];opc_server_avr[_0x21b5[40]]=  new Date();let _0xa2ffx20=opc_server_avr;_0xa2ffx20[_0x21b5[41]]= _0x21b5[34]; await CalcData[_0x21b5[38]](_0xa2ffx20);_0xa2ffx20[_0x21b5[41]]= _0x21b5[42]};let _0xa2ffx21,_0xa2ffx22;if(_0xa2ffx19> TIER_2_BENCHMARK){_0xa2ffx21= TIER_2_BENCHMARK/ 60+ _0xa2ffx1a;_0xa2ffx22= (_0xa2ffx19- TIER_2_BENCHMARK)/ 60+ _0xa2ffx1b}else {_0xa2ffx21= _0xa2ffx19/ 60+ _0xa2ffx1a;_0xa2ffx22= 0+ _0xa2ffx1b};opc_server[0][_0x21b5[26]]= _0xa2ffx21;opc_server[0][_0x21b5[27]]= _0xa2ffx22;insert_data(_0xa2ffx14,_0xa2ffx15,opc_server[0][_0x21b5[25]][0][_0x21b5[24]],opc_server[0][_0x21b5[25]][2][_0x21b5[24]],opc_server[0][_0x21b5[25]][1][_0x21b5[24]],opc_server[0][_0x21b5[25]][3][_0x21b5[24]],JSON[_0x21b5[39]](opc_server[0][_0x21b5[25]]),_0xa2ffx21,_0xa2ffx22,opc_server[0][_0x21b5[40]]);let _0xa2ffx1c={site_id:opc_server[0][_0x21b5[19]],site_name:opc_server[0][_0x21b5[20]],information:opc_server[0][_0x21b5[25]],tier1:opc_server[0][_0x21b5[26]],tier2:opc_server[0][_0x21b5[27]],created_at: new Date(),flag:1};let _0xa2ffx23=dateFormat(opc_server[0][_0x21b5[40]],_0x21b5[43]);let _0xa2ffx24=[{TimeStamp:_0xa2ffx23,Tagname:_0x21b5[44],Value:_0xa2ffx21},{TimeStamp:_0xa2ffx23,Tagname:_0x21b5[45],Value:_0xa2ffx22},{TimeStamp:_0xa2ffx23,Tagname:_0x21b5[46],Value:opc_server[0][_0x21b5[25]][1][_0x21b5[24]]},{TimeStamp:_0xa2ffx23,Tagname:_0x21b5[47],Value:opc_server[0][_0x21b5[25]][2][_0x21b5[24]]},{TimeStamp:_0xa2ffx23,Tagname:_0x21b5[48],Value:opc_server[0][_0x21b5[25]][0][_0x21b5[24]]},{TimeStamp:_0xa2ffx23,Tagname:_0x21b5[49],Value:opc_server[0][_0x21b5[25]][4][_0x21b5[24]]}];exportToCSVFile(_0xa2ffx24); await RawData[_0x21b5[38]](_0xa2ffx1c,function(_0xa2ffx25,_0xa2ffx26){if(_0xa2ffx25){console[_0x21b5[31]](_0x21b5[50])}})}},TIME_INTERVAL_GETDATA); await setInterval(async function(){if(interval_flag){let _0xa2ffx1d=moment()[_0x21b5[36]](15,_0x21b5[35]);let _0xa2ffx1e=moment();let _0xa2ffx1f={created_at:{$gte:_0xa2ffx1d,$lte:_0xa2ffx1e},tier1:{$gt:0}};let _0xa2ffx27= await RawData[_0x21b5[51]](_0xa2ffx1f);let _0xa2ffx28= await RawData[_0x21b5[52]](_0xa2ffx1f);let _0xa2ffx29=0;_0xa2ffx27[_0x21b5[54]](function(_0xa2ffx2a){_0xa2ffx29= _0xa2ffx29+ parseFloat(_0xa2ffx2a[_0x21b5[53]][3][_0x21b5[24]])});let _0xa2ffx2b=0;if(_0xa2ffx28> 0){_0xa2ffx2b= _0xa2ffx29/ _0xa2ffx28};let _0xa2ffx2c=opc_server_avr[_0x21b5[26]];let _0xa2ffx2d=opc_server_avr[_0x21b5[27]];let _0xa2ffx2e,_0xa2ffx2f;if(_0xa2ffx2b> TIER_2_BENCHMARK){_0xa2ffx2e= TIER_2_BENCHMARK/ 60+ _0xa2ffx2c;_0xa2ffx2f= (_0xa2ffx2b- TIER_2_BENCHMARK)/ 60+ _0xa2ffx2d}else {_0xa2ffx2e= _0xa2ffx2b/ 60+ _0xa2ffx2c;_0xa2ffx2f= 0+ _0xa2ffx2d};opc_server_avr[_0x21b5[26]]= _0xa2ffx2e;opc_server_avr[_0x21b5[27]]= _0xa2ffx2f;opc_server_avr[_0x21b5[40]]=  new Date();opc_server_avr[_0x21b5[55]]= _0xa2ffx2b;let _0xa2ffx30=opc_server_avr;_0xa2ffx30[_0x21b5[56]]= opc_server_avr[_0x21b5[55]]; await CalcData[_0x21b5[38]](_0xa2ffx30,function(_0xa2ffx25,_0xa2ffx26){if(_0xa2ffx25){console[_0x21b5[31]](_0x21b5[50])}}); await saveAvrDataToDatabase(opc_server[0][_0x21b5[19]],opc_server[0][_0x21b5[20]],opc_server_avr[_0x21b5[55]],opc_server_avr[_0x21b5[26]],opc_server_avr[_0x21b5[27]])}},TIME_INTERVAL_CALCDATA); await setInterval(async function(){let _0xa2ffx31=moment()[_0x21b5[36]](10,_0x21b5[57]);const _0xa2ffx32= await RawData[_0x21b5[58]]({created_at:{$lte:_0xa2ffx31}});console[_0x21b5[31]](_0x21b5[59],_0xa2ffx31,_0x21b5[60],_0xa2ffx32[_0x21b5[61]]);deleteDataAfter10days()},TIME_INTERVAL_REMOVE_DATA); await setInterval(async function(){saveConnectionStatusToDatabase(opc_server[0][_0x21b5[19]],opc_server[0][_0x21b5[20]],opc_server[0][_0x21b5[25]][4][_0x21b5[24]])},TIME_INTERVAL_GETDATA); await readOPCUA1()}run();async function readFirstConfig(){let _0xa2ffx34=[];let _0xa2ffx35=[process[_0x21b5[12]][_0x21b5[62]],process[_0x21b5[12]][_0x21b5[63]],process[_0x21b5[12]][_0x21b5[64]],process[_0x21b5[12]][_0x21b5[65]],process[_0x21b5[12]][_0x21b5[66]]];for(const _0xa2ffx36 of _0xa2ffx35){_0xa2ffx34[_0x21b5[69]]({name:_0xa2ffx36,value:0,time:moment()[_0x21b5[68]]()[_0x21b5[67]]()})};let _0xa2ffx37={id:1,site_id:process[_0x21b5[12]][_0x21b5[19]],site_name:process[_0x21b5[12]][_0x21b5[20]],ip:process[_0x21b5[12]][_0x21b5[70]],port:parseInt(process[_0x21b5[12]][_0x21b5[71]]),username:process[_0x21b5[12]][_0x21b5[72]],password:process[_0x21b5[12]][_0x21b5[73]],data:_0xa2ffx34,tier1:0,tier2:0,created_at: new Date()};opc_server_avr= {avrFlow:0,tier1:0,tier2:0};let _0xa2ffx38= await RawData[_0x21b5[76]]()[_0x21b5[75]]({_id:-1})[_0x21b5[74]](1);if(_0xa2ffx38){_0xa2ffx37[_0x21b5[26]]= _0xa2ffx38[_0x21b5[26]];_0xa2ffx37[_0x21b5[27]]= _0xa2ffx38[_0x21b5[27]]}else {_0xa2ffx37[_0x21b5[26]]= parseFloat(process[_0x21b5[12]].START_TIER_1);_0xa2ffx37[_0x21b5[27]]= parseFloat(process[_0x21b5[12]].START_TIER_2)};let _0xa2ffx39= await CalcData[_0x21b5[76]]()[_0x21b5[75]]({_id:-1})[_0x21b5[74]](1);if(_0xa2ffx39){opc_server_avr[_0x21b5[26]]= _0xa2ffx39[_0x21b5[26]];opc_server_avr[_0x21b5[27]]= _0xa2ffx39[_0x21b5[27]]}else {opc_server_avr[_0x21b5[26]]= parseFloat(process[_0x21b5[12]].START_AVR_TIER_1);opc_server_avr[_0x21b5[27]]= parseFloat(process[_0x21b5[12]].START_AVR_TIER_2)};opc_server[_0x21b5[69]](_0xa2ffx37);console[_0x21b5[31]](_0x21b5[77]);console[_0x21b5[31]](_0x21b5[78],opc_server,opc_server_avr);return}function insert_data(_0xa2ffx3b,_0xa2ffx3c,_0xa2ffx3d,_0xa2ffx3e,_0xa2ffx3f,_0xa2ffx40,_0xa2ffx41,_0xa2ffx21,_0xa2ffx22,_0xa2ffx42){sql[_0x21b5[13]](sqlConfig,function(_0xa2ffx43){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}else {var _0xa2ffx44= new sql.Request();_0xa2ffx44[_0x21b5[79]](_0x21b5[19],sql.VarChar,_0xa2ffx3b);_0xa2ffx44[_0x21b5[79]](_0x21b5[20],sql.VarChar,_0xa2ffx3c);_0xa2ffx44[_0x21b5[79]](_0x21b5[53],sql.VarChar,_0xa2ffx41);_0xa2ffx44[_0x21b5[79]](_0x21b5[40],sql.DateTimeOffset,_0xa2ffx42);_0xa2ffx44[_0x21b5[79]](_0x21b5[80],sql.Decimal(10,2),parseFloat(_0xa2ffx3d+ 0.0));_0xa2ffx44[_0x21b5[79]](_0x21b5[81],sql.Decimal(10,2),parseFloat(_0xa2ffx3e+ 0.0));_0xa2ffx44[_0x21b5[79]](_0x21b5[82],sql.Decimal(10,2),parseFloat(_0xa2ffx3f+ 0.0));_0xa2ffx44[_0x21b5[79]](_0x21b5[83],sql.Decimal(10,2),parseFloat(_0xa2ffx40+ 0.0));_0xa2ffx44[_0x21b5[79]](_0x21b5[26],sql.Decimal(10,2),parseFloat(_0xa2ffx21));_0xa2ffx44[_0x21b5[79]](_0x21b5[27],sql.Decimal(10,2),parseFloat(_0xa2ffx22));let _0xa2ffx45=_0x21b5[84]+ _0x21b5[85]+ _0x21b5[86];_0xa2ffx44[_0x21b5[87]](_0xa2ffx45,function(_0xa2ffx43,_0xa2ffx46){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}})}})}function saveAvrDataToDatabase(_0xa2ffx3b,_0xa2ffx3c,_0xa2ffx48,_0xa2ffx21,_0xa2ffx22){sql[_0x21b5[13]](sqlConfig,function(_0xa2ffx43){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}else {var _0xa2ffx44= new sql.Request();_0xa2ffx44[_0x21b5[79]](_0x21b5[19],sql.VarChar,_0xa2ffx3b);_0xa2ffx44[_0x21b5[79]](_0x21b5[20],sql.VarChar,_0xa2ffx3c);_0xa2ffx44[_0x21b5[79]](_0x21b5[55],sql.Decimal(10,2),parseFloat(_0xa2ffx48));_0xa2ffx44[_0x21b5[79]](_0x21b5[26],sql.Decimal(10,2),parseFloat(_0xa2ffx21));_0xa2ffx44[_0x21b5[79]](_0x21b5[27],sql.Decimal(10,2),parseFloat(_0xa2ffx22));_0xa2ffx44[_0x21b5[79]](_0x21b5[40],sql.DateTimeOffset, new Date());_0xa2ffx44[_0x21b5[87]](_0x21b5[88],function(_0xa2ffx43,_0xa2ffx46){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}})}})}function saveConnectionStatusToDatabase(_0xa2ffx3b,_0xa2ffx3c,_0xa2ffx4a){sql[_0x21b5[13]](sqlConfig,function(_0xa2ffx43){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}else {var _0xa2ffx44= new sql.Request();_0xa2ffx44[_0x21b5[79]](_0x21b5[19],sql.VarChar,_0xa2ffx3b);_0xa2ffx44[_0x21b5[79]](_0x21b5[20],sql.VarChar,_0xa2ffx3c);_0xa2ffx44[_0x21b5[79]](_0x21b5[89],sql.Bit,_0xa2ffx4a);_0xa2ffx44[_0x21b5[79]](_0x21b5[40],sql.DateTimeOffset, new Date());_0xa2ffx44[_0x21b5[87]](_0x21b5[90],function(_0xa2ffx43,_0xa2ffx46){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}})}})}function deleteDataAfter10days(){sql[_0x21b5[13]](sqlConfig,function(_0xa2ffx43){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}else {var _0xa2ffx44= new sql.Request();let _0xa2ffx31=moment()[_0x21b5[36]](10,_0x21b5[57]);let _0xa2ffx4c= new Date(_0xa2ffx31);_0xa2ffx44[_0x21b5[79]](_0x21b5[91],sql.DateTimeOffset,_0xa2ffx4c);_0xa2ffx44[_0x21b5[87]](_0x21b5[92],function(_0xa2ffx43,_0xa2ffx46){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}});_0xa2ffx44[_0x21b5[87]](_0x21b5[93],function(_0xa2ffx43,_0xa2ffx46){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)}});_0xa2ffx44[_0x21b5[87]](_0x21b5[94],function(_0xa2ffx43,_0xa2ffx46){if(_0xa2ffx43){console[_0x21b5[31]](_0xa2ffx43)};console[_0x21b5[31]](_0x21b5[95])})}});sql[_0x21b5[98]](_0x21b5[96],(_0xa2ffx43)=>{console[_0x21b5[31]](_0x21b5[97],_0xa2ffx43)})}async function readOPCUA1(){try{const _0xa2ffx4e={endpoint_must_exist:false};const _0xa2ffx4f=OPCUAClient[_0x21b5[99]](_0xa2ffx4e);_0xa2ffx4f[_0x21b5[98]](_0x21b5[100],(_0xa2ffx50,_0xa2ffx51)=>{console[_0x21b5[31]](_0x21b5[101],_0xa2ffx50,_0x21b5[102],_0xa2ffx51,_0x21b5[103])});_0xa2ffx4f[_0x21b5[98]](_0x21b5[104],()=>{console[_0x21b5[31]](_0x21b5[105]);opc_server[0][_0x21b5[25]][4][_0x21b5[24]]= 0});_0xa2ffx4f[_0x21b5[98]](_0x21b5[106],()=>{console[_0x21b5[31]](_0x21b5[107]);readOPCUA1()});_0xa2ffx4f[_0x21b5[98]](_0x21b5[108],()=>{console[_0x21b5[31]](_0x21b5[109]);opc_server[0][_0x21b5[25]][4][_0x21b5[24]]= 0});_0xa2ffx4f[_0x21b5[98]](_0x21b5[110],()=>{console[_0x21b5[31]](_0x21b5[111])});_0xa2ffx4f[_0x21b5[98]](_0x21b5[112],(_0xa2ffx43)=>{console[_0x21b5[31]](_0x21b5[113],_0xa2ffx43)}); await _0xa2ffx4f[_0x21b5[13]](process[_0x21b5[12]].FLEXY_URL);const _0xa2ffx52= await _0xa2ffx4f[_0x21b5[116]]({userName:opc_server[0][_0x21b5[114]],password:opc_server[0][_0x21b5[115]]});const _0xa2ffx53= await _0xa2ffx52[_0x21b5[117]]({maxNotificationsPerPublish:5000,publishingEnabled:true,requestedLifetimeCount:500,requestedMaxKeepAliveCount:50,requestedPublishingInterval:5000});_0xa2ffx53[_0x21b5[98]](_0x21b5[118],(_0xa2ffx54)=>{});const _0xa2ffx55=[];opc_server[0][_0x21b5[25]][_0x21b5[54]](function(_0xa2ffx56){let _0xa2ffx57=_0x21b5[119]+ flexy_ns+ _0x21b5[120]+ _0xa2ffx56[_0x21b5[121]];let _0xa2ffx58={attributeId:AttributeIds[_0x21b5[122]],nodeId:resolveNodeId(_0xa2ffx57)};_0xa2ffx55[_0x21b5[69]](_0xa2ffx58)});const _0xa2ffx59={discardOldest:true,queueSize:1,samplingInterval:10};const _0xa2ffx5a=ClientMonitoredItemGroup[_0x21b5[99]](_0xa2ffx53,_0xa2ffx55,_0xa2ffx59,TimestampsToReturn.Both);_0xa2ffx5a[_0x21b5[98]](_0x21b5[123],()=>{console[_0x21b5[31]](_0x21b5[124]);opc_server[0][_0x21b5[25]][4][_0x21b5[24]]= 1});_0xa2ffx5a[_0x21b5[98]](_0x21b5[125],(_0xa2ffx5b,_0xa2ffx5c,_0xa2ffx5d)=>{let _0xa2ffx5e=_0xa2ffx5b[_0x21b5[127]][_0x21b5[126]][_0x21b5[24]];let _0xa2ffx5f=_0xa2ffx5c[_0x21b5[128]].toString();var _0xa2ffx60=opc_server[0][_0x21b5[25]][_0x21b5[129]](function(_0xa2ffx61,_0xa2ffx62){return _0xa2ffx61[_0x21b5[121]]=== _0xa2ffx5e});opc_server[0][_0x21b5[25]][_0xa2ffx60][_0x21b5[24]]= parseFloat(_0xa2ffx5c[_0x21b5[24]][_0x21b5[24]][_0x21b5[130]](2));opc_server[0][_0x21b5[25]][_0xa2ffx60][_0x21b5[131]]=  new Date(_0xa2ffx5f);opc_server[0][_0x21b5[40]]=  new Date(_0xa2ffx5f);opc_server[0][_0x21b5[25]][4][_0x21b5[24]]= 1;interval_flag= 1}); await  new Promise((_0xa2ffx63)=>setTimeout(_0xa2ffx63,1000000000)); await _0xa2ffx5a[_0x21b5[132]](); await _0xa2ffx52[_0x21b5[133]](); await _0xa2ffx4f[_0x21b5[134]]();console[_0x21b5[31]](_0x21b5[135]);readOPCUA1()}catch(err){console[_0x21b5[31]](_0x21b5[136],err)}}function exportToCSVFile(_0xa2ffx16){const _0xa2ffx4e={fieldSeparator:_0x21b5[137],quoteStrings:_0x21b5[42],decimalSeparator:_0x21b5[138],showLabels:true,showTitle:true,title:_0x21b5[139],useTextFile:false,useBom:true,useKeysAsHeaders:false,headers:[_0x21b5[140],_0x21b5[141],_0x21b5[122]]};const _0xa2ffx65= new ExportToCsv(_0xa2ffx4e);const _0xa2ffx66=_0xa2ffx65[_0x21b5[142]](_0xa2ffx16,true);var _0xa2ffx67= new Date();_0xa2ffx67= moment(_0xa2ffx67)[_0x21b5[67]](_0x21b5[143]);let _0xa2ffx68=process[_0x21b5[12]][_0x21b5[144]]+ _0x21b5[145]+ process[_0x21b5[12]][_0x21b5[19]]+ _0x21b5[146]+ _0xa2ffx67+ _0x21b5[147];fs[_0x21b5[33]](_0xa2ffx68,_0xa2ffx66);let _0xa2ffx69=process[_0x21b5[12]][_0x21b5[148]]+ _0x21b5[149]+ moment()[_0x21b5[67]](_0x21b5[150]);let _0xa2ffx6a=_0xa2ffx69+ _0x21b5[149]+ moment()[_0x21b5[67]](_0x21b5[151]);let _0xa2ffx6b=_0xa2ffx6a+ _0x21b5[149]+ moment()[_0x21b5[67]](_0x21b5[152]);let _0xa2ffx6c=_0xa2ffx6b+ _0x21b5[149]+ moment()[_0x21b5[67]](_0x21b5[153]);const _0xa2ffx6d=mkdirp[_0x21b5[154]](_0xa2ffx69);const _0xa2ffx6e=mkdirp[_0x21b5[154]](_0xa2ffx6a);const _0xa2ffx6f=mkdirp[_0x21b5[154]](_0xa2ffx6b);const _0xa2ffx70=mkdirp[_0x21b5[154]](_0xa2ffx6c);let _0xa2ffx71=_0xa2ffx6c+ _0x21b5[145]+ process[_0x21b5[12]][_0x21b5[19]]+ _0x21b5[146]+ _0xa2ffx67+ _0x21b5[147];fs[_0x21b5[33]](_0xa2ffx71,_0xa2ffx66)}