var _0xad8f=["\x63\x6F\x6E\x66\x69\x67","\x64\x6F\x74\x65\x6E\x76","\x6D\x6F\x6D\x65\x6E\x74","\x66\x73","\x6D\x6B\x64\x69\x72\x70","\x45\x78\x70\x6F\x72\x74\x54\x6F\x43\x73\x76","\x65\x78\x70\x6F\x72\x74\x2D\x74\x6F\x2D\x63\x73\x76","\x6D\x6F\x6E\x67\x6F\x6F\x73\x65","\x6D\x73\x73\x71\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x72\x61\x77\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x63\x61\x6C\x63\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x65\x6E\x76","\x63\x6F\x6E\x6E\x65\x63\x74","\x75\x73\x65\x46\x69\x6E\x64\x41\x6E\x64\x4D\x6F\x64\x69\x66\x79","\x73\x65\x74","\x2E\x2F\x63\x6F\x6E\x66\x69\x67\x2F\x73\x71\x6C\x2E\x6A\x73","\x6E\x6F\x64\x65\x2D\x6F\x70\x63\x75\x61\x2D\x63\x6C\x69\x65\x6E\x74","\x46\x4C\x45\x58\x59\x5F\x4E\x61\x6D\x65\x73\x70\x61\x63\x65","\x73\x69\x74\x65\x5F\x69\x64","\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65","\x75\x73\x65\x72\x2F\x65\x64\x69\x74\x2E\x74\x78\x74","\x72\x65\x61\x64\x46\x69\x6C\x65\x53\x79\x6E\x63","\x70\x61\x72\x73\x65","\x76\x61\x6C\x75\x65","\x64\x61\x74\x61","\x74\x69\x65\x72\x31","\x74\x69\x65\x72\x32","\x61\x76\x72\x54\x69\x65\x72\x31","\x61\x76\x72\x54\x69\x65\x72\x32","\x75\x73\x65\x72\x20\x6D\x6F\x64\x69\x66\x69\x65\x64\x20","\x6C\x6F\x67","\x7B\x22\x74\x69\x65\x72\x31\x22\x3A\x20\x30\x2C\x20\x22\x74\x69\x65\x72\x32\x22\x3A\x20\x30\x2C\x20\x22\x61\x76\x72\x54\x69\x65\x72\x31\x22\x3A\x20\x30\x2C\x20\x22\x61\x76\x72\x54\x69\x65\x72\x32\x22\x3A\x30\x20\x7D","\x77\x72\x69\x74\x65\x46\x69\x6C\x65\x53\x79\x6E\x63","\x75\x73\x65\x72\x20\x6D\x6F\x64\x69\x66\x69\x65\x64","\x6D\x69\x6E\x75\x74\x65\x73","\x73\x75\x62\x74\x72\x61\x63\x74","\x75\x70\x64\x61\x74\x65\x4D\x61\x6E\x79","\x69\x6E\x73\x65\x72\x74\x4D\x61\x6E\x79","\x73\x74\x72\x69\x6E\x67\x69\x66\x79","\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74","\x6E\x6F\x74\x65","","\x59\x59\x59\x59\x2D\x4D\x4D\x2D\x44\x44\x20\x48\x48\x3A\x6D\x6D\x3A\x73\x73","\x66\x6F\x72\x6D\x61\x74","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x51\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x51\x2D\x47\x4E\x32\x32","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x50\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x54\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x43\x4F\x4D\x4D\x55\x4E\x49\x43\x41\x54\x49\x4F\x4E","\x45\x72\x72\x6F\x72\x20\x73\x61\x76\x65\x20\x64\x61\x74\x61\x20\x74\x6F\x20\x4C\x6F\x63\x61\x6C\x20\x64\x61\x74\x61","\x66\x69\x6E\x64","\x63\x6F\x75\x6E\x74\x44\x6F\x63\x75\x6D\x65\x6E\x74\x73","\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E","\x66\x6F\x72\x45\x61\x63\x68","\x61\x76\x72\x46\x6C\x6F\x77","\x61\x76\x72\x5F\x66\x6C\x6F\x77","\x64\x61\x79\x73","\x64\x65\x6C\x65\x74\x65\x4D\x61\x6E\x79","\x44\x65\x6C\x65\x74\x65\x64\x20\x64\x61\x74\x61\x20\x62\x65\x66\x6F\x72\x65\x20","\x54\x6F\x74\x61\x6C\x20\x72\x65\x63\x6F\x72\x64\x20\x64\x65\x6C\x65\x74\x65\x64\x20\x3D\x20","\x64\x65\x6C\x65\x74\x65\x64\x43\x6F\x75\x6E\x74","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x31","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x32","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x33","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x34","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x35","\x6C\x6F\x63\x61\x6C","\x70\x75\x73\x68","\x69\x70","\x70\x6F\x72\x74","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x55\x53\x45\x52\x4E\x41\x4D\x45","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x50\x41\x53\x53\x57\x4F\x52\x44","\x6C\x69\x6D\x69\x74","\x73\x6F\x72\x74","\x66\x69\x6E\x64\x4F\x6E\x65","\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A","\x46\x69\x72\x73\x74\x20\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x20","\x69\x6E\x70\x75\x74","\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65","\x70\x72\x65\x73\x73\x75\x72\x65","\x66\x6C\x6F\x77","\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65\x2C\x20\x70\x72\x65\x73\x73\x75\x72\x65\x2C\x20\x66\x6C\x6F\x77\x2C\x20\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77\x2C","\x20\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x29\x20\x56\x41\x4C\x55\x45\x53\x20","\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65\x2C\x40\x70\x72\x65\x73\x73\x75\x72\x65\x2C\x20\x40\x66\x6C\x6F\x77\x2C\x20\x40\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77\x2C\x20\x40\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x29","\x71\x75\x65\x72\x79","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x32\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x61\x76\x72\x66\x6C\x6F\x77\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x61\x76\x72\x46\x6C\x6F\x77\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29","\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x53\x74\x61\x74\x75\x73\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29","\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x32\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x53\x74\x61\x74\x75\x73\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x65\x6C\x65\x74\x65\x64\x20\x64\x61\x74\x61\x20\x62\x65\x66\x6F\x72\x65\x20\x31\x30\x20\x64\x61\x79\x73","\x65\x72\x72\x6F\x72","\x53\x51\x4C\x20\x68\x61\x73\x20\x69\x73\x73\x75\x65\x20","\x6F\x6E","\x63\x72\x65\x61\x74\x65","\x62\x61\x63\x6B\x6F\x66\x66","\x42\x61\x63\x6B\x6F\x66\x66\x20","\x20\x6E\x65\x78\x74\x20\x61\x74\x74\x65\x6D\x70\x74\x20\x69\x6E\x20","\x6D\x73","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x6C\x6F\x73\x74","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x6C\x6F\x73\x74","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x72\x65\x65\x73\x74\x61\x62\x6C\x69\x73\x68\x65\x64","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x72\x65\x2D\x65\x73\x74\x61\x62\x6C\x69\x73\x68\x65\x64","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x66\x61\x69\x6C\x65\x64","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x66\x61\x69\x6C\x65\x64","\x73\x74\x61\x72\x74\x5F\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x53\x74\x61\x72\x74\x69\x6E\x67\x20\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x61\x66\x74\x65\x72\x5F\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x41\x66\x74\x65\x72\x20\x52\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x65\x76\x65\x6E\x74\x20\x3D\x3E","\x75\x73\x65\x72\x6E\x61\x6D\x65","\x70\x61\x73\x73\x77\x6F\x72\x64","\x63\x72\x65\x61\x74\x65\x53\x65\x73\x73\x69\x6F\x6E","\x63\x72\x65\x61\x74\x65\x53\x75\x62\x73\x63\x72\x69\x70\x74\x69\x6F\x6E\x32","\x73\x74\x61\x72\x74\x65\x64","\x6E\x73\x3D","\x3B\x73\x3D","\x6E\x61\x6D\x65","\x56\x61\x6C\x75\x65","\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64","\x4F\x50\x43\x20\x55\x41\x20\x49\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64\x21\x20\x43\x6F\x6E\x6E\x65\x63\x74\x20\x74\x6F\x20\x46\x6C\x65\x78\x79\x20\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6C\x6C\x79","\x63\x68\x61\x6E\x67\x65\x64","\x6E\x6F\x64\x65\x49\x64","\x69\x74\x65\x6D\x54\x6F\x4D\x6F\x6E\x69\x74\x6F\x72","\x73\x65\x72\x76\x65\x72\x54\x69\x6D\x65\x73\x74\x61\x6D\x70","\x66\x69\x6E\x64\x49\x6E\x64\x65\x78","\x74\x6F\x46\x69\x78\x65\x64","\x74\x69\x6D\x65","\x74\x65\x72\x6D\x69\x6E\x61\x74\x65","\x63\x6C\x6F\x73\x65","\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74","\x44\x6F\x6E\x65\x20\x21","\x45\x72\x72\x6F\x72","\x2C","\x22","\x2E","\x44\x61\x74\x61","\x54\x69\x6D\x65\x53\x74\x61\x6D\x70","\x54\x61\x67\x6E\x61\x6D\x65","\x67\x65\x6E\x65\x72\x61\x74\x65\x43\x73\x76","\x59\x59\x59\x59\x4D\x4D\x44\x44\x5F\x48\x48\x6D\x6D\x73\x73","\x43\x53\x56\x5F\x45\x58\x50\x4F\x52\x54\x5F\x50\x41\x54\x48","\x5C\x44\x61\x74\x61\x5F","\x5F","\x2E\x63\x73\x76","\x43\x53\x56\x5F\x42\x41\x43\x4B\x55\x50\x5F\x50\x41\x54\x48","\x5C","\x59\x59\x59\x59","\x59\x59\x59\x59\x5F\x4D\x4D","\x59\x59\x59\x59\x5F\x4D\x4D\x5F\x44\x44","\x59\x59\x59\x59\x5F\x4D\x4D\x5F\x44\x44\x5F\x48\x48","\x73\x79\x6E\x63"];require(_0xad8f[1])[_0xad8f[0]]();var moment=require(_0xad8f[2]);var fs=require(_0xad8f[3]);const mkdirp=require(_0xad8f[4]);const ExportToCsv=require(_0xad8f[6])[_0xad8f[5]];var mongoose=require(_0xad8f[7]);var sql=require(_0xad8f[8]);var RawData=require(_0xad8f[9]);var CalcData=require(_0xad8f[10]);mongoose[_0xad8f[12]](process[_0xad8f[11]].MONGO_URL,{useNewUrlParser:true,useUnifiedTopology:true});mongoose[_0xad8f[14]](_0xad8f[13],false);const sqlConfig=require(_0xad8f[15]);const {OPCUAClient,resolveNodeId,AttributeIds,ClientMonitoredItemGroup,TimestampsToReturn}=require(_0xad8f[16]);let TIER_2_BENCHMARK=parseFloat(process[_0xad8f[11]].TIER_2_BENCHMARK);let TIME_INTERVAL_GETDATA=parseInt(process[_0xad8f[11]].TIME_INTERVAL_GETDATA)* 1000;let TIME_INTERVAL_CALCDATA=parseInt(process[_0xad8f[11]].TIME_INTERVAL_CALCDATA)* 1000;let TIME_INTERVAL_REMOVE_DATA=parseInt(process[_0xad8f[11]].TIME_INTERVAL_REMOVE_DATA)* 86400000;let flexy_ns=process[_0xad8f[11]][_0xad8f[17]];var opc_server=[];var opc_server_avr=[];var interval_flag=0;async function run(){ await readFirstConfig(); await setTimeout(function(){},2000); await setInterval(async function(){let _0xcc86x13=opc_server[0][_0xad8f[18]];let _0xcc86x14=opc_server[0][_0xad8f[19]];if(interval_flag){const _0xcc86x15= await fs[_0xad8f[21]](_0xad8f[20]);let _0xcc86x16=_0xcc86x15.toString();let _0xcc86x17=JSON[_0xad8f[22]](_0xcc86x16);let _0xcc86x18=opc_server[0][_0xad8f[24]][3][_0xad8f[23]];let _0xcc86x19=opc_server[0][_0xad8f[25]];let _0xcc86x1a=opc_server[0][_0xad8f[26]];if(_0xcc86x17[_0xad8f[25]]> 0|| _0xcc86x17[_0xad8f[26]]> 0|| _0xcc86x17[_0xad8f[27]]> 0|| _0xcc86x17[_0xad8f[28]]> 0){console[_0xad8f[30]](_0xad8f[29],_0xcc86x17[_0xad8f[25]],_0xcc86x17[_0xad8f[26]],_0xcc86x17[_0xad8f[27]],_0xcc86x17[_0xad8f[28]]);fs[_0xad8f[32]](_0xad8f[20],_0xad8f[31]);_0xcc86x19= _0xcc86x17[_0xad8f[25]];_0xcc86x1a= _0xcc86x17[_0xad8f[26]];let _0xcc86x1b={site_id:opc_server[0][_0xad8f[18]],site_name:opc_server[0][_0xad8f[19]],information:opc_server[0][_0xad8f[24]],tier1:_0xcc86x17[_0xad8f[25]],tier2:_0xcc86x17[_0xad8f[26]],created_at: new Date(),flag:1,note:_0xad8f[33]};let _0xcc86x1c=moment()[_0xad8f[35]](20,_0xad8f[34]);let _0xcc86x1d=moment();let _0xcc86x1e={created_at:{$gte:_0xcc86x1c},tier1:{$gt:0}}; await RawData[_0xad8f[36]](_0xcc86x1e,{$set:{flag:0}}); await RawData[_0xad8f[37]](_0xcc86x1b);insert_data(_0xcc86x13,_0xcc86x14,opc_server[0][_0xad8f[24]][0][_0xad8f[23]],opc_server[0][_0xad8f[24]][2][_0xad8f[23]],opc_server[0][_0xad8f[24]][1][_0xad8f[23]],opc_server[0][_0xad8f[24]][3][_0xad8f[23]],JSON[_0xad8f[38]](opc_server[0][_0xad8f[24]]),_0xcc86x17[_0xad8f[25]],_0xcc86x17[_0xad8f[26]],opc_server[0][_0xad8f[39]]);opc_server_avr[_0xad8f[25]]= _0xcc86x17[_0xad8f[27]];opc_server_avr[_0xad8f[26]]= _0xcc86x17[_0xad8f[28]];opc_server_avr[_0xad8f[39]]=  new Date();let _0xcc86x1f=opc_server_avr;_0xcc86x1f[_0xad8f[40]]= _0xad8f[33]; await CalcData[_0xad8f[37]](_0xcc86x1f);_0xcc86x1f[_0xad8f[40]]= _0xad8f[41]};let _0xcc86x20,_0xcc86x21;if(_0xcc86x18> TIER_2_BENCHMARK){_0xcc86x20= TIER_2_BENCHMARK/ 60+ _0xcc86x19;_0xcc86x21= (_0xcc86x18- TIER_2_BENCHMARK)/ 60+ _0xcc86x1a}else {_0xcc86x20= _0xcc86x18/ 60+ _0xcc86x19;_0xcc86x21= 0+ _0xcc86x1a};opc_server[0][_0xad8f[25]]= _0xcc86x20;opc_server[0][_0xad8f[26]]= _0xcc86x21;insert_data(_0xcc86x13,_0xcc86x14,opc_server[0][_0xad8f[24]][0][_0xad8f[23]],opc_server[0][_0xad8f[24]][2][_0xad8f[23]],opc_server[0][_0xad8f[24]][1][_0xad8f[23]],opc_server[0][_0xad8f[24]][3][_0xad8f[23]],JSON[_0xad8f[38]](opc_server[0][_0xad8f[24]]),_0xcc86x20,_0xcc86x21,opc_server[0][_0xad8f[39]]);let _0xcc86x1b={site_id:opc_server[0][_0xad8f[18]],site_name:opc_server[0][_0xad8f[19]],information:opc_server[0][_0xad8f[24]],tier1:opc_server[0][_0xad8f[25]],tier2:opc_server[0][_0xad8f[26]],created_at: new Date(),flag:1};let _0xcc86x22=moment(opc_server[0][_0xad8f[39]])[_0xad8f[43]](_0xad8f[42]);let _0xcc86x23=[{TimeStamp:_0xcc86x22,Tagname:_0xad8f[44],Value:_0xcc86x20},{TimeStamp:_0xcc86x22,Tagname:_0xad8f[45],Value:_0xcc86x21},{TimeStamp:_0xcc86x22,Tagname:_0xad8f[46],Value:opc_server[0][_0xad8f[24]][1][_0xad8f[23]]},{TimeStamp:_0xcc86x22,Tagname:_0xad8f[47],Value:opc_server[0][_0xad8f[24]][2][_0xad8f[23]]},{TimeStamp:_0xcc86x22,Tagname:_0xad8f[48],Value:opc_server[0][_0xad8f[24]][0][_0xad8f[23]]},{TimeStamp:_0xcc86x22,Tagname:_0xad8f[49],Value:opc_server[0][_0xad8f[24]][4][_0xad8f[23]]}];exportToCSVFile(_0xcc86x23); await RawData[_0xad8f[37]](_0xcc86x1b,function(_0xcc86x24,_0xcc86x25){if(_0xcc86x24){console[_0xad8f[30]](_0xad8f[50])}})}},TIME_INTERVAL_GETDATA); await setInterval(async function(){if(interval_flag){let _0xcc86x1c=moment()[_0xad8f[35]](15,_0xad8f[34]);let _0xcc86x1d=moment();let _0xcc86x1e={created_at:{$gte:_0xcc86x1c,$lte:_0xcc86x1d},tier1:{$gt:0}};let _0xcc86x26= await RawData[_0xad8f[51]](_0xcc86x1e);let _0xcc86x27= await RawData[_0xad8f[52]](_0xcc86x1e);let _0xcc86x28=0;_0xcc86x26[_0xad8f[54]](function(_0xcc86x29){_0xcc86x28= _0xcc86x28+ parseFloat(_0xcc86x29[_0xad8f[53]][3][_0xad8f[23]])});let _0xcc86x2a=0;if(_0xcc86x27> 0){_0xcc86x2a= _0xcc86x28/ _0xcc86x27};let _0xcc86x2b=opc_server_avr[_0xad8f[25]];let _0xcc86x2c=opc_server_avr[_0xad8f[26]];let _0xcc86x2d,_0xcc86x2e;if(_0xcc86x2a> TIER_2_BENCHMARK){_0xcc86x2d= TIER_2_BENCHMARK/ 60+ _0xcc86x2b;_0xcc86x2e= (_0xcc86x2a- TIER_2_BENCHMARK)/ 60+ _0xcc86x2c}else {_0xcc86x2d= _0xcc86x2a/ 60+ _0xcc86x2b;_0xcc86x2e= 0+ _0xcc86x2c};opc_server_avr[_0xad8f[25]]= _0xcc86x2d;opc_server_avr[_0xad8f[26]]= _0xcc86x2e;opc_server_avr[_0xad8f[39]]=  new Date();opc_server_avr[_0xad8f[55]]= _0xcc86x2a;let _0xcc86x2f=opc_server_avr;_0xcc86x2f[_0xad8f[56]]= opc_server_avr[_0xad8f[55]]; await CalcData[_0xad8f[37]](_0xcc86x2f,function(_0xcc86x24,_0xcc86x25){if(_0xcc86x24){console[_0xad8f[30]](_0xad8f[50])}}); await saveAvrDataToDatabase(opc_server[0][_0xad8f[18]],opc_server[0][_0xad8f[19]],opc_server_avr[_0xad8f[55]],opc_server_avr[_0xad8f[25]],opc_server_avr[_0xad8f[26]])}},TIME_INTERVAL_CALCDATA); await setInterval(async function(){let _0xcc86x30=moment()[_0xad8f[35]](10,_0xad8f[57]);const _0xcc86x31= await RawData[_0xad8f[58]]({created_at:{$lte:_0xcc86x30}});console[_0xad8f[30]](_0xad8f[59],_0xcc86x30,_0xad8f[60],_0xcc86x31[_0xad8f[61]]);deleteDataAfter10days()},TIME_INTERVAL_REMOVE_DATA); await setInterval(async function(){saveConnectionStatusToDatabase(opc_server[0][_0xad8f[18]],opc_server[0][_0xad8f[19]],opc_server[0][_0xad8f[24]][4][_0xad8f[23]])},TIME_INTERVAL_GETDATA); await readOPCUA1()}run();async function readFirstConfig(){let _0xcc86x33=[];let _0xcc86x34=[process[_0xad8f[11]][_0xad8f[62]],process[_0xad8f[11]][_0xad8f[63]],process[_0xad8f[11]][_0xad8f[64]],process[_0xad8f[11]][_0xad8f[65]],process[_0xad8f[11]][_0xad8f[66]]];for(const _0xcc86x35 of _0xcc86x34){_0xcc86x33[_0xad8f[68]]({name:_0xcc86x35,value:0,time:moment()[_0xad8f[67]]()[_0xad8f[43]]()})};let _0xcc86x36={id:1,site_id:process[_0xad8f[11]][_0xad8f[18]],site_name:process[_0xad8f[11]][_0xad8f[19]],ip:process[_0xad8f[11]][_0xad8f[69]],port:parseInt(process[_0xad8f[11]][_0xad8f[70]]),username:process[_0xad8f[11]][_0xad8f[71]],password:process[_0xad8f[11]][_0xad8f[72]],data:_0xcc86x33,tier1:0,tier2:0,created_at: new Date()};opc_server_avr= {avrFlow:0,tier1:0,tier2:0};let _0xcc86x37= await RawData[_0xad8f[75]]()[_0xad8f[74]]({_id:-1})[_0xad8f[73]](1);if(_0xcc86x37){_0xcc86x36[_0xad8f[25]]= _0xcc86x37[_0xad8f[25]];_0xcc86x36[_0xad8f[26]]= _0xcc86x37[_0xad8f[26]]}else {_0xcc86x36[_0xad8f[25]]= parseFloat(process[_0xad8f[11]].START_TIER_1);_0xcc86x36[_0xad8f[26]]= parseFloat(process[_0xad8f[11]].START_TIER_2)};let _0xcc86x38= await CalcData[_0xad8f[75]]()[_0xad8f[74]]({_id:-1})[_0xad8f[73]](1);if(_0xcc86x38){opc_server_avr[_0xad8f[25]]= _0xcc86x38[_0xad8f[25]];opc_server_avr[_0xad8f[26]]= _0xcc86x38[_0xad8f[26]]}else {opc_server_avr[_0xad8f[25]]= parseFloat(process[_0xad8f[11]].START_AVR_TIER_1);opc_server_avr[_0xad8f[26]]= parseFloat(process[_0xad8f[11]].START_AVR_TIER_2)};opc_server[_0xad8f[68]](_0xcc86x36);console[_0xad8f[30]](_0xad8f[76]);console[_0xad8f[30]](_0xad8f[77],opc_server,opc_server_avr);return}function insert_data(_0xcc86x3a,_0xcc86x3b,_0xcc86x3c,_0xcc86x3d,_0xcc86x3e,_0xcc86x3f,_0xcc86x40,_0xcc86x20,_0xcc86x21,_0xcc86x41){sql[_0xad8f[12]](sqlConfig,function(_0xcc86x42){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}else {var _0xcc86x43= new sql.Request();_0xcc86x43[_0xad8f[78]](_0xad8f[18],sql.VarChar,_0xcc86x3a);_0xcc86x43[_0xad8f[78]](_0xad8f[19],sql.VarChar,_0xcc86x3b);_0xcc86x43[_0xad8f[78]](_0xad8f[53],sql.VarChar,_0xcc86x40);_0xcc86x43[_0xad8f[78]](_0xad8f[39],sql.DateTimeOffset,_0xcc86x41);_0xcc86x43[_0xad8f[78]](_0xad8f[79],sql.Decimal(10,2),parseFloat(_0xcc86x3c+ 0.0));_0xcc86x43[_0xad8f[78]](_0xad8f[80],sql.Decimal(10,2),parseFloat(_0xcc86x3d+ 0.0));_0xcc86x43[_0xad8f[78]](_0xad8f[81],sql.Decimal(10,2),parseFloat(_0xcc86x3e+ 0.0));_0xcc86x43[_0xad8f[78]](_0xad8f[82],sql.Decimal(10,2),parseFloat(_0xcc86x3f+ 0.0));_0xcc86x43[_0xad8f[78]](_0xad8f[25],sql.Decimal(10,2),parseFloat(_0xcc86x20));_0xcc86x43[_0xad8f[78]](_0xad8f[26],sql.Decimal(10,2),parseFloat(_0xcc86x21));let _0xcc86x44=_0xad8f[83]+ _0xad8f[84]+ _0xad8f[85];_0xcc86x43[_0xad8f[86]](_0xcc86x44,function(_0xcc86x42,_0xcc86x45){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}})}})}function saveAvrDataToDatabase(_0xcc86x3a,_0xcc86x3b,_0xcc86x47,_0xcc86x20,_0xcc86x21){sql[_0xad8f[12]](sqlConfig,function(_0xcc86x42){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}else {var _0xcc86x43= new sql.Request();_0xcc86x43[_0xad8f[78]](_0xad8f[18],sql.VarChar,_0xcc86x3a);_0xcc86x43[_0xad8f[78]](_0xad8f[19],sql.VarChar,_0xcc86x3b);_0xcc86x43[_0xad8f[78]](_0xad8f[55],sql.Decimal(10,2),parseFloat(_0xcc86x47));_0xcc86x43[_0xad8f[78]](_0xad8f[25],sql.Decimal(10,2),parseFloat(_0xcc86x20));_0xcc86x43[_0xad8f[78]](_0xad8f[26],sql.Decimal(10,2),parseFloat(_0xcc86x21));_0xcc86x43[_0xad8f[78]](_0xad8f[39],sql.DateTimeOffset, new Date());_0xcc86x43[_0xad8f[86]](_0xad8f[87],function(_0xcc86x42,_0xcc86x45){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}})}})}function saveConnectionStatusToDatabase(_0xcc86x3a,_0xcc86x3b,_0xcc86x49){sql[_0xad8f[12]](sqlConfig,function(_0xcc86x42){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}else {var _0xcc86x43= new sql.Request();_0xcc86x43[_0xad8f[78]](_0xad8f[18],sql.VarChar,_0xcc86x3a);_0xcc86x43[_0xad8f[78]](_0xad8f[19],sql.VarChar,_0xcc86x3b);_0xcc86x43[_0xad8f[78]](_0xad8f[88],sql.Bit,_0xcc86x49);_0xcc86x43[_0xad8f[78]](_0xad8f[39],sql.DateTimeOffset, new Date());_0xcc86x43[_0xad8f[86]](_0xad8f[89],function(_0xcc86x42,_0xcc86x45){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}})}})}function deleteDataAfter10days(){sql[_0xad8f[12]](sqlConfig,function(_0xcc86x42){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}else {var _0xcc86x43= new sql.Request();let _0xcc86x30=moment()[_0xad8f[35]](10,_0xad8f[57]);let _0xcc86x4b= new Date(_0xcc86x30);_0xcc86x43[_0xad8f[78]](_0xad8f[90],sql.DateTimeOffset,_0xcc86x4b);_0xcc86x43[_0xad8f[86]](_0xad8f[91],function(_0xcc86x42,_0xcc86x45){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}});_0xcc86x43[_0xad8f[86]](_0xad8f[92],function(_0xcc86x42,_0xcc86x45){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)}});_0xcc86x43[_0xad8f[86]](_0xad8f[93],function(_0xcc86x42,_0xcc86x45){if(_0xcc86x42){console[_0xad8f[30]](_0xcc86x42)};console[_0xad8f[30]](_0xad8f[94])})}});sql[_0xad8f[97]](_0xad8f[95],(_0xcc86x42)=>{console[_0xad8f[30]](_0xad8f[96],_0xcc86x42)})}async function readOPCUA1(){try{const _0xcc86x4d={endpoint_must_exist:false};const _0xcc86x4e=OPCUAClient[_0xad8f[98]](_0xcc86x4d);_0xcc86x4e[_0xad8f[97]](_0xad8f[99],(_0xcc86x4f,_0xcc86x50)=>{console[_0xad8f[30]](_0xad8f[100],_0xcc86x4f,_0xad8f[101],_0xcc86x50,_0xad8f[102])});_0xcc86x4e[_0xad8f[97]](_0xad8f[103],()=>{console[_0xad8f[30]](_0xad8f[104]);opc_server[0][_0xad8f[24]][4][_0xad8f[23]]= 0});_0xcc86x4e[_0xad8f[97]](_0xad8f[105],()=>{console[_0xad8f[30]](_0xad8f[106]);readOPCUA1()});_0xcc86x4e[_0xad8f[97]](_0xad8f[107],()=>{console[_0xad8f[30]](_0xad8f[108]);opc_server[0][_0xad8f[24]][4][_0xad8f[23]]= 0});_0xcc86x4e[_0xad8f[97]](_0xad8f[109],()=>{console[_0xad8f[30]](_0xad8f[110])});_0xcc86x4e[_0xad8f[97]](_0xad8f[111],(_0xcc86x42)=>{console[_0xad8f[30]](_0xad8f[112],_0xcc86x42)}); await _0xcc86x4e[_0xad8f[12]](process[_0xad8f[11]].FLEXY_URL);const _0xcc86x51= await _0xcc86x4e[_0xad8f[115]]({userName:opc_server[0][_0xad8f[113]],password:opc_server[0][_0xad8f[114]]});const _0xcc86x52= await _0xcc86x51[_0xad8f[116]]({maxNotificationsPerPublish:5000,publishingEnabled:true,requestedLifetimeCount:500,requestedMaxKeepAliveCount:50,requestedPublishingInterval:5000});_0xcc86x52[_0xad8f[97]](_0xad8f[117],(_0xcc86x53)=>{});const _0xcc86x54=[];opc_server[0][_0xad8f[24]][_0xad8f[54]](function(_0xcc86x55){let _0xcc86x56=_0xad8f[118]+ flexy_ns+ _0xad8f[119]+ _0xcc86x55[_0xad8f[120]];let _0xcc86x57={attributeId:AttributeIds[_0xad8f[121]],nodeId:resolveNodeId(_0xcc86x56)};_0xcc86x54[_0xad8f[68]](_0xcc86x57)});const _0xcc86x58={discardOldest:true,queueSize:1,samplingInterval:10};const _0xcc86x59=ClientMonitoredItemGroup[_0xad8f[98]](_0xcc86x52,_0xcc86x54,_0xcc86x58,TimestampsToReturn.Both);_0xcc86x59[_0xad8f[97]](_0xad8f[122],()=>{console[_0xad8f[30]](_0xad8f[123]);opc_server[0][_0xad8f[24]][4][_0xad8f[23]]= 1});_0xcc86x59[_0xad8f[97]](_0xad8f[124],(_0xcc86x5a,_0xcc86x5b,_0xcc86x5c)=>{let _0xcc86x5d=_0xcc86x5a[_0xad8f[126]][_0xad8f[125]][_0xad8f[23]];let _0xcc86x5e=_0xcc86x5b[_0xad8f[127]].toString();var _0xcc86x5f=opc_server[0][_0xad8f[24]][_0xad8f[128]](function(_0xcc86x60,_0xcc86x61){return _0xcc86x60[_0xad8f[120]]=== _0xcc86x5d});opc_server[0][_0xad8f[24]][_0xcc86x5f][_0xad8f[23]]= parseFloat(_0xcc86x5b[_0xad8f[23]][_0xad8f[23]][_0xad8f[129]](2));opc_server[0][_0xad8f[24]][_0xcc86x5f][_0xad8f[130]]=  new Date(_0xcc86x5e);opc_server[0][_0xad8f[39]]=  new Date(_0xcc86x5e);opc_server[0][_0xad8f[24]][4][_0xad8f[23]]= 1;interval_flag= 1}); await  new Promise((_0xcc86x62)=>setTimeout(_0xcc86x62,1000000000)); await _0xcc86x59[_0xad8f[131]](); await _0xcc86x51[_0xad8f[132]](); await _0xcc86x4e[_0xad8f[133]]();console[_0xad8f[30]](_0xad8f[134]);readOPCUA1()}catch(err){console[_0xad8f[30]](_0xad8f[135],err)}}function exportToCSVFile(_0xcc86x15){const _0xcc86x4d={fieldSeparator:_0xad8f[136],quoteStrings:_0xad8f[137],decimalSeparator:_0xad8f[138],showLabels:true,showTitle:false,title:_0xad8f[139],useTextFile:false,useBom:true,useKeysAsHeaders:false,headers:[_0xad8f[140],_0xad8f[141],_0xad8f[121]]};const _0xcc86x64= new ExportToCsv(_0xcc86x4d);const _0xcc86x65=_0xcc86x64[_0xad8f[142]](_0xcc86x15,true);var _0xcc86x66= new Date();_0xcc86x66= moment(_0xcc86x66)[_0xad8f[43]](_0xad8f[143]);let _0xcc86x67=process[_0xad8f[11]][_0xad8f[144]]+ _0xad8f[145]+ process[_0xad8f[11]][_0xad8f[18]]+ _0xad8f[146]+ _0xcc86x66+ _0xad8f[147];fs[_0xad8f[32]](_0xcc86x67,_0xcc86x65);let _0xcc86x68=process[_0xad8f[11]][_0xad8f[148]]+ _0xad8f[149]+ moment()[_0xad8f[43]](_0xad8f[150]);let _0xcc86x69=_0xcc86x68+ _0xad8f[149]+ moment()[_0xad8f[43]](_0xad8f[151]);let _0xcc86x6a=_0xcc86x69+ _0xad8f[149]+ moment()[_0xad8f[43]](_0xad8f[152]);let _0xcc86x6b=_0xcc86x6a+ _0xad8f[149]+ moment()[_0xad8f[43]](_0xad8f[153]);const _0xcc86x6c=mkdirp[_0xad8f[154]](_0xcc86x68);const _0xcc86x6d=mkdirp[_0xad8f[154]](_0xcc86x69);const _0xcc86x6e=mkdirp[_0xad8f[154]](_0xcc86x6a);const _0xcc86x6f=mkdirp[_0xad8f[154]](_0xcc86x6b);let _0xcc86x70=_0xcc86x6b+ _0xad8f[145]+ process[_0xad8f[11]][_0xad8f[18]]+ _0xad8f[146]+ _0xcc86x66+ _0xad8f[147];fs[_0xad8f[32]](_0xcc86x70,_0xcc86x65)}