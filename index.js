var _0x38ec=["\x63\x6F\x6E\x66\x69\x67","\x64\x6F\x74\x65\x6E\x76","\x6D\x6F\x6D\x65\x6E\x74","\x6D\x6F\x6E\x67\x6F\x6F\x73\x65","\x6D\x73\x73\x71\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x72\x61\x77\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x65\x6E\x76","\x63\x6F\x6E\x6E\x65\x63\x74","\x75\x73\x65\x46\x69\x6E\x64\x41\x6E\x64\x4D\x6F\x64\x69\x66\x79","\x73\x65\x74","\x53\x51\x4C\x5F\x53\x45\x52\x56\x45\x52\x5F\x50\x41\x53\x53\x57\x4F\x52\x44","\x53\x51\x4C\x5F\x53\x45\x52\x56\x45\x52\x5F\x44\x41\x54\x41\x42\x41\x53\x45","\x53\x51\x4C\x5F\x53\x45\x52\x56\x45\x52\x5F\x55\x53\x45\x52\x4E\x41\x4D\x45","\x53\x51\x4C\x5F\x53\x45\x52\x56\x45\x52\x5F\x53\x45\x52\x56\x45\x52","\x74\x65\x64\x69\x6F\x75\x73","\x76\x61\x6C\x75\x65","\x64\x61\x74\x61","\x74\x69\x65\x72\x31","\x74\x69\x65\x72\x32","\x73\x69\x74\x65\x5F\x69\x64","\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65","\x73\x74\x72\x69\x6E\x67\x69\x66\x79","\x45\x72\x72\x6F\x72\x20\x73\x61\x76\x65\x20\x64\x61\x74\x61\x20\x74\x6F\x20\x4C\x6F\x63\x61\x6C\x20\x64\x61\x74\x61","\x6C\x6F\x67","\x69\x6E\x73\x65\x72\x74\x4D\x61\x6E\x79","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x31","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x32","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x33","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x34","\x66\x6F\x72\x6D\x61\x74","\x6C\x6F\x63\x61\x6C","\x70\x75\x73\x68","\x69\x70","\x70\x6F\x72\x74","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x55\x53\x45\x52\x4E\x41\x4D\x45","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x50\x41\x53\x53\x57\x4F\x52\x44","\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A","\x6E\x6F\x64\x65\x2D\x6F\x70\x63\x75\x61","\x61\x73\x79\x6E\x63","\x6F\x70\x63\x2E\x74\x63\x70\x3A\x2F\x2F","\x3A","\x43\x61\x6E\x6E\x6F\x74\x20\x63\x6F\x6E\x6E\x65\x63\x74\x20\x74\x6F\x20\x65\x6E\x64\x70\x6F\x69\x6E\x74\x20\x3A","\x63\x6F\x6E\x6E\x65\x63\x74\x65\x64\x20\x21","\x75\x73\x65\x72\x6E\x61\x6D\x65","\x70\x61\x73\x73\x77\x6F\x72\x64","\x63\x72\x65\x61\x74\x65\x53\x65\x73\x73\x69\x6F\x6E","\x74\x65\x72\x6D\x69\x6E\x61\x74\x65\x64","\x6F\x6E","\x6B\x65\x65\x70\x61\x6C\x69\x76\x65","\x73\x74\x61\x72\x74\x65\x64","\x6E\x73\x3D\x34\x3B\x73\x3D","\x6E\x61\x6D\x65","\x72\x65\x73\x6F\x6C\x76\x65\x4E\x6F\x64\x65\x49\x64","\x6D\x6F\x6E\x69\x74\x6F\x72","\x63\x68\x61\x6E\x67\x65\x64","\x22\x54\x61\x67\x4E\x61\x6D\x65\x22","\x22","\x2C","\x22\x56\x61\x6C\x75\x65\x22","\x66\x69\x6E\x64\x49\x6E\x64\x65\x78","\x74\x6F\x46\x69\x78\x65\x64","\x74\x69\x6D\x65","\x66\x6F\x72\x45\x61\x63\x68","\x20\x63\x6C\x6F\x73\x69\x6E\x67\x20\x73\x65\x73\x73\x69\x6F\x6E","\x20\x73\x65\x73\x73\x69\x6F\x6E\x20\x63\x6C\x6F\x73\x65\x64","\x63\x6C\x6F\x73\x65","\x20\x66\x61\x69\x6C\x75\x72\x65\x20","\x64\x6F\x6E\x65\x21","\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74","\x73\x65\x72\x69\x65\x73","\x69\x6E\x70\x75\x74","\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E","\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x29","\x71\x75\x65\x72\x79"];require(_0x38ec[1])[_0x38ec[0]]();var moment=require(_0x38ec[2]);var mongoose=require(_0x38ec[3]);var sql=require(_0x38ec[4]);var RawData=require(_0x38ec[5]);mongoose[_0x38ec[7]](process[_0x38ec[6]].MONGO_URL,{useNewUrlParser:true,useUnifiedTopology:true});mongoose[_0x38ec[9]](_0x38ec[8],false);const sqlConfig={password:process[_0x38ec[6]][_0x38ec[10]],database:process[_0x38ec[6]][_0x38ec[11]],stream:false,options:{enableArithAbort:true,encrypt:true},port:parseInt(process[_0x38ec[6]].SQL_SERVER_PORT),user:process[_0x38ec[6]][_0x38ec[12]],server:process[_0x38ec[6]][_0x38ec[13]],driver:_0x38ec[14]};let TIER_2_BENCHMARK=parseFloat(process[_0x38ec[6]].TIER_2_BENCHMARK);let TIME_INTERVAL_GETDATA=parseInt(process[_0x38ec[6]].TIME_INTERVAL_GETDATA)* 1000;var opc_server=[];async function run(){ await readFirstConfig(); await readOPCUA(); await setTimeout(function(){},5000); await setInterval(async function(){let _0xaaa8xa=opc_server[0][_0x38ec[16]][3][_0x38ec[15]];let _0xaaa8xb=opc_server[0][_0x38ec[17]];let _0xaaa8xc=opc_server[0][_0x38ec[18]];let _0xaaa8xd,_0xaaa8xe;if(_0xaaa8xa> TIER_2_BENCHMARK){_0xaaa8xd= TIER_2_BENCHMARK/ 60+ _0xaaa8xb;_0xaaa8xe= (_0xaaa8xa- TIER_2_BENCHMARK)/ 60+ _0xaaa8xc}else {_0xaaa8xd= _0xaaa8xa/ 60+ _0xaaa8xb;_0xaaa8xe= 0+ _0xaaa8xc};opc_server[0][_0x38ec[17]]= _0xaaa8xd;opc_server[0][_0x38ec[18]]= _0xaaa8xe;insert_data(opc_server[0][_0x38ec[19]],opc_server[0][_0x38ec[20]],JSON[_0x38ec[21]](opc_server[0][_0x38ec[16]]),_0xaaa8xd,_0xaaa8xe);let _0xaaa8xf={site_id:opc_server[0][_0x38ec[19]],site_name:opc_server[0][_0x38ec[20]],information:opc_server[0][_0x38ec[16]],tier1:opc_server[0][_0x38ec[17]],tier2:opc_server[0][_0x38ec[18]],created_at: new Date()};RawData[_0x38ec[24]](_0xaaa8xf,function(_0xaaa8x10,_0xaaa8x11){if(_0xaaa8x10){console[_0x38ec[23]](_0x38ec[22])}})},TIME_INTERVAL_GETDATA); await setInterval(async function(){},2000)}run();async function readFirstConfig(){let _0xaaa8x13=[];let _0xaaa8x14=[process[_0x38ec[6]][_0x38ec[25]],process[_0x38ec[6]][_0x38ec[26]],process[_0x38ec[6]][_0x38ec[27]],process[_0x38ec[6]][_0x38ec[28]]];for(const _0xaaa8x15 of _0xaaa8x14){_0xaaa8x13[_0x38ec[31]]({name:_0xaaa8x15,value:0,time:moment()[_0x38ec[30]]()[_0x38ec[29]]()})};let _0xaaa8x16={id:1,site_id:process[_0x38ec[6]][_0x38ec[19]],site_name:process[_0x38ec[6]][_0x38ec[20]],ip:process[_0x38ec[6]][_0x38ec[32]],port:parseInt(process[_0x38ec[6]][_0x38ec[33]]),username:process[_0x38ec[6]][_0x38ec[34]],password:process[_0x38ec[6]][_0x38ec[35]],data:_0xaaa8x13,tier1:0,tier2:0};opc_server[_0x38ec[31]](_0xaaa8x16);console[_0x38ec[23]](_0x38ec[36]);console[_0x38ec[23]](_0xaaa8x14,opc_server);return}async function readOPCUA(){var _0xaaa8x18=require(_0x38ec[37]),_0xaaa8x19=require(_0x38ec[38]),_0xaaa8x1a= new _0xaaa8x18.OPCUAClient(),_0xaaa8x1b= new Array(),_0xaaa8x1c=0,_0xaaa8x1d= new Array(),_0xaaa8x1e=null;const _0xaaa8x1f=_0x38ec[39]+ opc_server[0][_0x38ec[32]]+ _0x38ec[40]+ opc_server[0][_0x38ec[33]];_0xaaa8x19[_0x38ec[69]]([function(_0xaaa8x20){_0xaaa8x1a[_0x38ec[7]](_0xaaa8x1f,function(_0xaaa8x21){if(_0xaaa8x21){console[_0x38ec[23]](_0x38ec[41],_0xaaa8x1f)}else {console[_0x38ec[23]](_0x38ec[42])};_0xaaa8x20(_0xaaa8x21)})},function(_0xaaa8x20){_0xaaa8x1a[_0x38ec[45]]({userName:opc_server[0][_0x38ec[43]],password:opc_server[0][_0x38ec[44]]},function(_0xaaa8x21,_0xaaa8x22){if(!_0xaaa8x21){_0xaaa8x1e= _0xaaa8x22};_0xaaa8x20(_0xaaa8x21)})},function(_0xaaa8x20){the_subscription=  new _0xaaa8x18.ClientSubscription(_0xaaa8x1e,{requestedPublishingInterval:1000,requestedLifetimeCount:10,requestedMaxKeepAliveCount:2,maxNotificationsPerPublish:10,publishingEnabled:true,priority:10});the_subscription[_0x38ec[47]](_0x38ec[49],function(){})[_0x38ec[47]](_0x38ec[48],function(){})[_0x38ec[47]](_0x38ec[46],function(){_0xaaa8x20()});opc_server[0][_0x38ec[16]][_0x38ec[62]](function(_0xaaa8x23){var _0xaaa8x24=_0x38ec[50]+ _0xaaa8x23[_0x38ec[51]];_0xaaa8x1d[_0xaaa8x1c]= the_subscription[_0x38ec[53]]({nodeId:_0xaaa8x18[_0x38ec[52]](_0xaaa8x24),attributeId:13},{samplingInterval:200,discardOldest:true,queueSize:10});_0xaaa8x1d[_0xaaa8x1c][_0x38ec[47]](_0x38ec[54],function(_0xaaa8x25){mesage= _0x38ec[55]+ _0x38ec[40]+ _0x38ec[56]+ _0xaaa8x23+ _0x38ec[56]+ _0x38ec[57]+ _0x38ec[58]+ _0x38ec[40]+ _0xaaa8x25[_0x38ec[15]][_0x38ec[15]];var _0xaaa8x26=opc_server[0][_0x38ec[16]][_0x38ec[59]](function(_0xaaa8x27,_0xaaa8x28){return _0xaaa8x27[_0x38ec[51]]=== _0xaaa8x23[_0x38ec[51]]});opc_server[0][_0x38ec[16]][_0xaaa8x26][_0x38ec[15]]= parseFloat(_0xaaa8x25[_0x38ec[15]][_0x38ec[15]][_0x38ec[60]](2));opc_server[0][_0x38ec[16]][_0xaaa8x26][_0x38ec[61]]=  new Date()});_0xaaa8x1c= _0xaaa8x1c+ 1})},function(_0xaaa8x20){console[_0x38ec[23]](_0x38ec[63]);_0xaaa8x1e[_0x38ec[65]](function(_0xaaa8x21){console[_0x38ec[23]](_0x38ec[64]);_0xaaa8x20()})}],function(_0xaaa8x21){if(_0xaaa8x21){console[_0x38ec[23]](_0x38ec[66],_0xaaa8x21)}else {console[_0x38ec[23]](_0x38ec[67])};_0xaaa8x1a[_0x38ec[68]](function(){})})}function insert_data(_0xaaa8x2a,_0xaaa8x2b,_0xaaa8x2c,_0xaaa8xd,_0xaaa8xe){sql[_0x38ec[7]](sqlConfig,function(_0xaaa8x21){if(_0xaaa8x21){console[_0x38ec[23]](_0xaaa8x21)}else {var _0xaaa8x2d= new sql.Request();_0xaaa8x2d[_0x38ec[70]](_0x38ec[19],sql.VarChar,_0xaaa8x2a);_0xaaa8x2d[_0x38ec[70]](_0x38ec[20],sql.VarChar,_0xaaa8x2b);_0xaaa8x2d[_0x38ec[70]](_0x38ec[71],sql.VarChar,_0xaaa8x2c);_0xaaa8x2d[_0x38ec[70]](_0x38ec[72],sql.DateTimeOffset, new Date());_0xaaa8x2d[_0x38ec[70]](_0x38ec[17],sql.Decimal(10,2),parseFloat(_0xaaa8xd));_0xaaa8x2d[_0x38ec[70]](_0x38ec[18],sql.Decimal(10,2),parseFloat(_0xaaa8xe));_0xaaa8x2d[_0x38ec[74]](_0x38ec[73],function(_0xaaa8x21,_0xaaa8x2e){if(_0xaaa8x21){console[_0x38ec[23]](_0xaaa8x21)};sql[_0x38ec[65]]()})}})}