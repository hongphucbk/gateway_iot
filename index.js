var _0xbd52=["\x63\x6F\x6E\x66\x69\x67","\x64\x6F\x74\x65\x6E\x76","\x6D\x6F\x6D\x65\x6E\x74","\x66\x73","\x6D\x6B\x64\x69\x72\x70","\x64\x61\x74\x65\x66\x6F\x72\x6D\x61\x74","\x45\x78\x70\x6F\x72\x74\x54\x6F\x43\x73\x76","\x65\x78\x70\x6F\x72\x74\x2D\x74\x6F\x2D\x63\x73\x76","\x6D\x6F\x6E\x67\x6F\x6F\x73\x65","\x6D\x73\x73\x71\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x72\x61\x77\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x63\x61\x6C\x63\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x65\x6E\x76","\x63\x6F\x6E\x6E\x65\x63\x74","\x75\x73\x65\x46\x69\x6E\x64\x41\x6E\x64\x4D\x6F\x64\x69\x66\x79","\x73\x65\x74","\x2E\x2F\x63\x6F\x6E\x66\x69\x67\x2F\x73\x71\x6C\x2E\x6A\x73","\x6E\x6F\x64\x65\x2D\x6F\x70\x63\x75\x61\x2D\x63\x6C\x69\x65\x6E\x74","\x46\x4C\x45\x58\x59\x5F\x4E\x61\x6D\x65\x73\x70\x61\x63\x65","\x73\x69\x74\x65\x5F\x69\x64","\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65","\x75\x73\x65\x72\x2F\x65\x64\x69\x74\x2E\x74\x78\x74","\x72\x65\x61\x64\x46\x69\x6C\x65\x53\x79\x6E\x63","\x70\x61\x72\x73\x65","\x76\x61\x6C\x75\x65","\x64\x61\x74\x61","\x74\x69\x65\x72\x31","\x74\x69\x65\x72\x32","\x61\x76\x72\x54\x69\x65\x72\x31","\x61\x76\x72\x54\x69\x65\x72\x32","\x75\x73\x65\x72\x20\x6D\x6F\x64\x69\x66\x69\x65\x64\x20","\x6C\x6F\x67","\x7B\x22\x74\x69\x65\x72\x31\x22\x3A\x20\x30\x2C\x20\x22\x74\x69\x65\x72\x32\x22\x3A\x20\x30\x2C\x20\x22\x61\x76\x72\x54\x69\x65\x72\x31\x22\x3A\x20\x30\x2C\x20\x22\x61\x76\x72\x54\x69\x65\x72\x32\x22\x3A\x30\x20\x7D","\x77\x72\x69\x74\x65\x46\x69\x6C\x65\x53\x79\x6E\x63","\x75\x73\x65\x72\x20\x6D\x6F\x64\x69\x66\x69\x65\x64","\x6D\x69\x6E\x75\x74\x65\x73","\x73\x75\x62\x74\x72\x61\x63\x74","\x75\x70\x64\x61\x74\x65\x4D\x61\x6E\x79","\x69\x6E\x73\x65\x72\x74\x4D\x61\x6E\x79","\x73\x74\x72\x69\x6E\x67\x69\x66\x79","\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74","\x6E\x6F\x74\x65","","\x6D\x6D\x2F\x64\x64\x2F\x79\x79\x79\x79\x20\x48\x48\x3A\x4D\x4D","\x54\x69\x6D\x65\x53\x74\x61\x6D\x70","\x54\x61\x67\x6E\x61\x6D\x65","\x56\x61\x6C\x75\x65","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x51\x2D\x47\x4E\x32\x31","\x74\x6F\x46\x69\x78\x65\x64","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x51\x2D\x47\x4E\x32\x32","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x54\x2D\x47\x4E\x32\x31\x2D\x43\x4F\x4D\x50","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x54\x2D\x47\x4E\x32\x31\x2D\x52\x41\x57","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x50\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x54\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x43\x4F\x4D\x4D\x55\x4E\x49\x43\x41\x54\x49\x4F\x4E","\x45\x72\x72\x6F\x72\x20\x73\x61\x76\x65\x20\x64\x61\x74\x61\x20\x74\x6F\x20\x4C\x6F\x63\x61\x6C\x20\x64\x61\x74\x61","\x66\x69\x6E\x64","\x63\x6F\x75\x6E\x74\x44\x6F\x63\x75\x6D\x65\x6E\x74\x73","\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E","\x66\x6F\x72\x45\x61\x63\x68","\x61\x76\x72\x46\x6C\x6F\x77","\x61\x76\x72\x5F\x66\x6C\x6F\x77","\x64\x61\x79\x73","\x64\x65\x6C\x65\x74\x65\x4D\x61\x6E\x79","\x44\x65\x6C\x65\x74\x65\x64\x20\x64\x61\x74\x61\x20\x62\x65\x66\x6F\x72\x65\x20","\x54\x6F\x74\x61\x6C\x20\x72\x65\x63\x6F\x72\x64\x20\x64\x65\x6C\x65\x74\x65\x64\x20\x3D\x20","\x64\x65\x6C\x65\x74\x65\x64\x43\x6F\x75\x6E\x74","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x31","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x32","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x33","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x34","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x35","\x66\x6F\x72\x6D\x61\x74","\x6C\x6F\x63\x61\x6C","\x70\x75\x73\x68","\x69\x70","\x70\x6F\x72\x74","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x55\x53\x45\x52\x4E\x41\x4D\x45","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x50\x41\x53\x53\x57\x4F\x52\x44","\x6C\x69\x6D\x69\x74","\x73\x6F\x72\x74","\x66\x69\x6E\x64\x4F\x6E\x65","\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A","\x46\x69\x72\x73\x74\x20\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x20","\x69\x6E\x70\x75\x74","\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65","\x70\x72\x65\x73\x73\x75\x72\x65","\x66\x6C\x6F\x77","\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65\x2C\x20\x70\x72\x65\x73\x73\x75\x72\x65\x2C\x20\x66\x6C\x6F\x77\x2C\x20\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77\x2C","\x20\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x29\x20\x56\x41\x4C\x55\x45\x53\x20","\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65\x2C\x40\x70\x72\x65\x73\x73\x75\x72\x65\x2C\x20\x40\x66\x6C\x6F\x77\x2C\x20\x40\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77\x2C\x20\x40\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x29","\x71\x75\x65\x72\x79","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x32\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x61\x76\x72\x66\x6C\x6F\x77\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x61\x76\x72\x46\x6C\x6F\x77\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29","\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x53\x74\x61\x74\x75\x73\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29","\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x32\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x53\x74\x61\x74\x75\x73\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x65\x6C\x65\x74\x65\x64\x20\x64\x61\x74\x61\x20\x62\x65\x66\x6F\x72\x65\x20\x31\x30\x20\x64\x61\x79\x73","\x65\x72\x72\x6F\x72","\x53\x51\x4C\x20\x68\x61\x73\x20\x69\x73\x73\x75\x65\x20","\x6F\x6E","\x63\x72\x65\x61\x74\x65","\x62\x61\x63\x6B\x6F\x66\x66","\x42\x61\x63\x6B\x6F\x66\x66\x20","\x20\x6E\x65\x78\x74\x20\x61\x74\x74\x65\x6D\x70\x74\x20\x69\x6E\x20","\x6D\x73","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x6C\x6F\x73\x74","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x6C\x6F\x73\x74","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x72\x65\x65\x73\x74\x61\x62\x6C\x69\x73\x68\x65\x64","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x72\x65\x2D\x65\x73\x74\x61\x62\x6C\x69\x73\x68\x65\x64","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x66\x61\x69\x6C\x65\x64","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x66\x61\x69\x6C\x65\x64","\x73\x74\x61\x72\x74\x5F\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x53\x74\x61\x72\x74\x69\x6E\x67\x20\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x61\x66\x74\x65\x72\x5F\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x41\x66\x74\x65\x72\x20\x52\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x65\x76\x65\x6E\x74\x20\x3D\x3E","\x75\x73\x65\x72\x6E\x61\x6D\x65","\x70\x61\x73\x73\x77\x6F\x72\x64","\x63\x72\x65\x61\x74\x65\x53\x65\x73\x73\x69\x6F\x6E","\x63\x72\x65\x61\x74\x65\x53\x75\x62\x73\x63\x72\x69\x70\x74\x69\x6F\x6E\x32","\x73\x74\x61\x72\x74\x65\x64","\x6E\x73\x3D","\x3B\x73\x3D","\x6E\x61\x6D\x65","\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64","\x4F\x50\x43\x20\x55\x41\x20\x49\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64\x21\x20\x43\x6F\x6E\x6E\x65\x63\x74\x20\x74\x6F\x20\x46\x6C\x65\x78\x79\x20\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6C\x6C\x79","\x63\x68\x61\x6E\x67\x65\x64","\x6E\x6F\x64\x65\x49\x64","\x69\x74\x65\x6D\x54\x6F\x4D\x6F\x6E\x69\x74\x6F\x72","\x73\x65\x72\x76\x65\x72\x54\x69\x6D\x65\x73\x74\x61\x6D\x70","\x66\x69\x6E\x64\x49\x6E\x64\x65\x78","\x74\x69\x6D\x65","\x74\x65\x72\x6D\x69\x6E\x61\x74\x65","\x63\x6C\x6F\x73\x65","\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74","\x44\x6F\x6E\x65\x20\x21","\x45\x72\x72\x6F\x72","\x2C","\x2E","\x5B\x44\x61\x74\x61\x5D","\x5B\x44\x41\x54\x41\x5D","\x67\x65\x6E\x65\x72\x61\x74\x65\x43\x73\x76","\x59\x59\x59\x59\x4D\x4D\x44\x44\x5F\x48\x48\x6D\x6D\x73\x73","\x43\x53\x56\x5F\x45\x58\x50\x4F\x52\x54\x5F\x50\x41\x54\x48","\x5C\x44\x61\x74\x61\x5F","\x5F","\x2E\x63\x73\x76","\x43\x53\x56\x5F\x42\x41\x43\x4B\x55\x50\x5F\x50\x41\x54\x48","\x5C","\x59\x59\x59\x59","\x59\x59\x59\x59\x5F\x4D\x4D","\x59\x59\x59\x59\x5F\x4D\x4D\x5F\x44\x44","\x59\x59\x59\x59\x5F\x4D\x4D\x5F\x44\x44\x5F\x48\x48","\x73\x79\x6E\x63"];require(_0xbd52[1])[_0xbd52[0]]();var moment=require(_0xbd52[2]);var fs=require(_0xbd52[3]);const mkdirp=require(_0xbd52[4]);var dateFormat=require(_0xbd52[5]);const ExportToCsv=require(_0xbd52[7])[_0xbd52[6]];var mongoose=require(_0xbd52[8]);var sql=require(_0xbd52[9]);var RawData=require(_0xbd52[10]);var CalcData=require(_0xbd52[11]);mongoose[_0xbd52[13]](process[_0xbd52[12]].MONGO_URL,{useNewUrlParser:true,useUnifiedTopology:true});mongoose[_0xbd52[15]](_0xbd52[14],false);const sqlConfig=require(_0xbd52[16]);const {OPCUAClient,resolveNodeId,AttributeIds,ClientMonitoredItemGroup,TimestampsToReturn}=require(_0xbd52[17]);let TIER_2_BENCHMARK=parseFloat(process[_0xbd52[12]].TIER_2_BENCHMARK);let TIME_INTERVAL_GETDATA=parseInt(process[_0xbd52[12]].TIME_INTERVAL_GETDATA)* 1000;let TIME_INTERVAL_CALCDATA=parseInt(process[_0xbd52[12]].TIME_INTERVAL_CALCDATA)* 1000;let TIME_INTERVAL_REMOVE_DATA=parseInt(process[_0xbd52[12]].TIME_INTERVAL_REMOVE_DATA)* 86400000;let flexy_ns=process[_0xbd52[12]][_0xbd52[18]];var opc_server=[];var opc_server_avr=[];var interval_flag=0;async function run(){ await readFirstConfig(); await setTimeout(function(){},2000); await setInterval(async function(){let _0x1efax14=opc_server[0][_0xbd52[19]];let _0x1efax15=opc_server[0][_0xbd52[20]];if(interval_flag){const _0x1efax16= await fs[_0xbd52[22]](_0xbd52[21]);let _0x1efax17=_0x1efax16.toString();let _0x1efax18=JSON[_0xbd52[23]](_0x1efax17);let _0x1efax19=opc_server[0][_0xbd52[25]][3][_0xbd52[24]];let _0x1efax1a=opc_server[0][_0xbd52[26]];let _0x1efax1b=opc_server[0][_0xbd52[27]];if(_0x1efax18[_0xbd52[26]]> 0|| _0x1efax18[_0xbd52[27]]> 0|| _0x1efax18[_0xbd52[28]]> 0|| _0x1efax18[_0xbd52[29]]> 0){console[_0xbd52[31]](_0xbd52[30],_0x1efax18[_0xbd52[26]],_0x1efax18[_0xbd52[27]],_0x1efax18[_0xbd52[28]],_0x1efax18[_0xbd52[29]]);fs[_0xbd52[33]](_0xbd52[21],_0xbd52[32]);_0x1efax1a= _0x1efax18[_0xbd52[26]];_0x1efax1b= _0x1efax18[_0xbd52[27]];let _0x1efax1c={site_id:opc_server[0][_0xbd52[19]],site_name:opc_server[0][_0xbd52[20]],information:opc_server[0][_0xbd52[25]],tier1:_0x1efax18[_0xbd52[26]],tier2:_0x1efax18[_0xbd52[27]],created_at: new Date(),flag:1,note:_0xbd52[34]};let _0x1efax1d=moment()[_0xbd52[36]](20,_0xbd52[35]);let _0x1efax1e=moment();let _0x1efax1f={created_at:{$gte:_0x1efax1d},tier1:{$gt:0}}; await RawData[_0xbd52[37]](_0x1efax1f,{$set:{flag:0}}); await RawData[_0xbd52[38]](_0x1efax1c);insert_data(_0x1efax14,_0x1efax15,opc_server[0][_0xbd52[25]][0][_0xbd52[24]],opc_server[0][_0xbd52[25]][2][_0xbd52[24]],opc_server[0][_0xbd52[25]][1][_0xbd52[24]],opc_server[0][_0xbd52[25]][3][_0xbd52[24]],JSON[_0xbd52[39]](opc_server[0][_0xbd52[25]]),_0x1efax18[_0xbd52[26]],_0x1efax18[_0xbd52[27]],opc_server[0][_0xbd52[40]]);opc_server_avr[_0xbd52[26]]= _0x1efax18[_0xbd52[28]];opc_server_avr[_0xbd52[27]]= _0x1efax18[_0xbd52[29]];opc_server_avr[_0xbd52[40]]=  new Date();let _0x1efax20=opc_server_avr;_0x1efax20[_0xbd52[41]]= _0xbd52[34]; await CalcData[_0xbd52[38]](_0x1efax20);_0x1efax20[_0xbd52[41]]= _0xbd52[42]};let _0x1efax21,_0x1efax22;if(_0x1efax19> TIER_2_BENCHMARK){_0x1efax21= TIER_2_BENCHMARK/ 60+ _0x1efax1a;_0x1efax22= (_0x1efax19- TIER_2_BENCHMARK)/ 60+ _0x1efax1b}else {_0x1efax21= _0x1efax19/ 60+ _0x1efax1a;_0x1efax22= 0+ _0x1efax1b};opc_server[0][_0xbd52[26]]= _0x1efax21;opc_server[0][_0xbd52[27]]= _0x1efax22;insert_data(_0x1efax14,_0x1efax15,opc_server[0][_0xbd52[25]][0][_0xbd52[24]],opc_server[0][_0xbd52[25]][2][_0xbd52[24]],opc_server[0][_0xbd52[25]][1][_0xbd52[24]],opc_server[0][_0xbd52[25]][3][_0xbd52[24]],JSON[_0xbd52[39]](opc_server[0][_0xbd52[25]]),_0x1efax21,_0x1efax22,opc_server[0][_0xbd52[40]]);let _0x1efax1c={site_id:opc_server[0][_0xbd52[19]],site_name:opc_server[0][_0xbd52[20]],information:opc_server[0][_0xbd52[25]],tier1:opc_server[0][_0xbd52[26]],tier2:opc_server[0][_0xbd52[27]],created_at: new Date(),flag:1};let _0x1efax23=dateFormat(_0x1efax1c[_0xbd52[40]],_0xbd52[43]);let _0x1efax24=[{TimeStamp:_0xbd52[44],Tagname:_0xbd52[45],Value:_0xbd52[46]},{TimeStamp:_0x1efax23,Tagname:_0xbd52[47],Value:_0x1efax21[_0xbd52[48]](1)},{TimeStamp:_0x1efax23,Tagname:_0xbd52[49],Value:_0x1efax22[_0xbd52[48]](1)},{TimeStamp:_0x1efax23,Tagname:_0xbd52[50],Value:opc_server[0][_0xbd52[25]][3][_0xbd52[24]]},{TimeStamp:_0x1efax23,Tagname:_0xbd52[51],Value:opc_server[0][_0xbd52[25]][1][_0xbd52[24]]},{TimeStamp:_0x1efax23,Tagname:_0xbd52[52],Value:opc_server[0][_0xbd52[25]][2][_0xbd52[24]]},{TimeStamp:_0x1efax23,Tagname:_0xbd52[53],Value:opc_server[0][_0xbd52[25]][0][_0xbd52[24]]},{TimeStamp:_0x1efax23,Tagname:_0xbd52[54],Value:opc_server[0][_0xbd52[25]][4][_0xbd52[24]]}];exportToCSVFile(_0x1efax24); await RawData[_0xbd52[38]](_0x1efax1c,function(_0x1efax25,_0x1efax26){if(_0x1efax25){console[_0xbd52[31]](_0xbd52[55])}})}},TIME_INTERVAL_GETDATA); await setInterval(async function(){if(interval_flag){let _0x1efax1d=moment()[_0xbd52[36]](15,_0xbd52[35]);let _0x1efax1e=moment();let _0x1efax1f={created_at:{$gte:_0x1efax1d,$lte:_0x1efax1e},tier1:{$gt:0}};let _0x1efax27= await RawData[_0xbd52[56]](_0x1efax1f);let _0x1efax28= await RawData[_0xbd52[57]](_0x1efax1f);let _0x1efax29=0;_0x1efax27[_0xbd52[59]](function(_0x1efax2a){_0x1efax29= _0x1efax29+ parseFloat(_0x1efax2a[_0xbd52[58]][3][_0xbd52[24]])});let _0x1efax2b=0;if(_0x1efax28> 0){_0x1efax2b= _0x1efax29/ _0x1efax28};let _0x1efax2c=opc_server_avr[_0xbd52[26]];let _0x1efax2d=opc_server_avr[_0xbd52[27]];let _0x1efax2e,_0x1efax2f;if(_0x1efax2b> TIER_2_BENCHMARK){_0x1efax2e= TIER_2_BENCHMARK/ 60+ _0x1efax2c;_0x1efax2f= (_0x1efax2b- TIER_2_BENCHMARK)/ 60+ _0x1efax2d}else {_0x1efax2e= _0x1efax2b/ 60+ _0x1efax2c;_0x1efax2f= 0+ _0x1efax2d};opc_server_avr[_0xbd52[26]]= _0x1efax2e;opc_server_avr[_0xbd52[27]]= _0x1efax2f;opc_server_avr[_0xbd52[40]]=  new Date();opc_server_avr[_0xbd52[60]]= _0x1efax2b;let _0x1efax30=opc_server_avr;_0x1efax30[_0xbd52[61]]= opc_server_avr[_0xbd52[60]]; await CalcData[_0xbd52[38]](_0x1efax30,function(_0x1efax25,_0x1efax26){if(_0x1efax25){console[_0xbd52[31]](_0xbd52[55])}}); await saveAvrDataToDatabase(opc_server[0][_0xbd52[19]],opc_server[0][_0xbd52[20]],opc_server_avr[_0xbd52[60]],opc_server_avr[_0xbd52[26]],opc_server_avr[_0xbd52[27]])}},TIME_INTERVAL_CALCDATA); await setInterval(async function(){let _0x1efax31=moment()[_0xbd52[36]](10,_0xbd52[62]);const _0x1efax32= await RawData[_0xbd52[63]]({created_at:{$lte:_0x1efax31}});console[_0xbd52[31]](_0xbd52[64],_0x1efax31,_0xbd52[65],_0x1efax32[_0xbd52[66]]);deleteDataAfter10days()},TIME_INTERVAL_REMOVE_DATA); await setInterval(async function(){saveConnectionStatusToDatabase(opc_server[0][_0xbd52[19]],opc_server[0][_0xbd52[20]],opc_server[0][_0xbd52[25]][4][_0xbd52[24]])},TIME_INTERVAL_GETDATA); await readOPCUA1()}run();async function readFirstConfig(){let _0x1efax34=[];let _0x1efax35=[process[_0xbd52[12]][_0xbd52[67]],process[_0xbd52[12]][_0xbd52[68]],process[_0xbd52[12]][_0xbd52[69]],process[_0xbd52[12]][_0xbd52[70]],process[_0xbd52[12]][_0xbd52[71]]];for(const _0x1efax36 of _0x1efax35){_0x1efax34[_0xbd52[74]]({name:_0x1efax36,value:0,time:moment()[_0xbd52[73]]()[_0xbd52[72]]()})};let _0x1efax37={id:1,site_id:process[_0xbd52[12]][_0xbd52[19]],site_name:process[_0xbd52[12]][_0xbd52[20]],ip:process[_0xbd52[12]][_0xbd52[75]],port:parseInt(process[_0xbd52[12]][_0xbd52[76]]),username:process[_0xbd52[12]][_0xbd52[77]],password:process[_0xbd52[12]][_0xbd52[78]],data:_0x1efax34,tier1:0,tier2:0,created_at: new Date()};opc_server_avr= {avrFlow:0,tier1:0,tier2:0};let _0x1efax38= await RawData[_0xbd52[81]]()[_0xbd52[80]]({_id:-1})[_0xbd52[79]](1);if(_0x1efax38){_0x1efax37[_0xbd52[26]]= _0x1efax38[_0xbd52[26]];_0x1efax37[_0xbd52[27]]= _0x1efax38[_0xbd52[27]]}else {_0x1efax37[_0xbd52[26]]= parseFloat(process[_0xbd52[12]].START_TIER_1);_0x1efax37[_0xbd52[27]]= parseFloat(process[_0xbd52[12]].START_TIER_2)};let _0x1efax39= await CalcData[_0xbd52[81]]()[_0xbd52[80]]({_id:-1})[_0xbd52[79]](1);if(_0x1efax39){opc_server_avr[_0xbd52[26]]= _0x1efax39[_0xbd52[26]];opc_server_avr[_0xbd52[27]]= _0x1efax39[_0xbd52[27]]}else {opc_server_avr[_0xbd52[26]]= parseFloat(process[_0xbd52[12]].START_AVR_TIER_1);opc_server_avr[_0xbd52[27]]= parseFloat(process[_0xbd52[12]].START_AVR_TIER_2)};opc_server[_0xbd52[74]](_0x1efax37);console[_0xbd52[31]](_0xbd52[82]);console[_0xbd52[31]](_0xbd52[83],opc_server,opc_server_avr);return}function insert_data(_0x1efax3b,_0x1efax3c,_0x1efax3d,_0x1efax3e,_0x1efax3f,_0x1efax40,_0x1efax41,_0x1efax21,_0x1efax22,_0x1efax42){sql[_0xbd52[13]](sqlConfig,function(_0x1efax43){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}else {var _0x1efax44= new sql.Request();_0x1efax44[_0xbd52[84]](_0xbd52[19],sql.VarChar,_0x1efax3b);_0x1efax44[_0xbd52[84]](_0xbd52[20],sql.VarChar,_0x1efax3c);_0x1efax44[_0xbd52[84]](_0xbd52[58],sql.VarChar,_0x1efax41);_0x1efax44[_0xbd52[84]](_0xbd52[40],sql.DateTimeOffset,_0x1efax42);_0x1efax44[_0xbd52[84]](_0xbd52[85],sql.Decimal(10,2),parseFloat(_0x1efax3d+ 0.0));_0x1efax44[_0xbd52[84]](_0xbd52[86],sql.Decimal(10,2),parseFloat(_0x1efax3e+ 0.0));_0x1efax44[_0xbd52[84]](_0xbd52[87],sql.Decimal(10,2),parseFloat(_0x1efax3f+ 0.0));_0x1efax44[_0xbd52[84]](_0xbd52[88],sql.Decimal(10,2),parseFloat(_0x1efax40+ 0.0));_0x1efax44[_0xbd52[84]](_0xbd52[26],sql.Decimal(10,2),parseFloat(_0x1efax21));_0x1efax44[_0xbd52[84]](_0xbd52[27],sql.Decimal(10,2),parseFloat(_0x1efax22));let _0x1efax45=_0xbd52[89]+ _0xbd52[90]+ _0xbd52[91];_0x1efax44[_0xbd52[92]](_0x1efax45,function(_0x1efax43,_0x1efax46){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}})}})}function saveAvrDataToDatabase(_0x1efax3b,_0x1efax3c,_0x1efax48,_0x1efax21,_0x1efax22){sql[_0xbd52[13]](sqlConfig,function(_0x1efax43){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}else {var _0x1efax44= new sql.Request();_0x1efax44[_0xbd52[84]](_0xbd52[19],sql.VarChar,_0x1efax3b);_0x1efax44[_0xbd52[84]](_0xbd52[20],sql.VarChar,_0x1efax3c);_0x1efax44[_0xbd52[84]](_0xbd52[60],sql.Decimal(10,2),parseFloat(_0x1efax48));_0x1efax44[_0xbd52[84]](_0xbd52[26],sql.Decimal(10,2),parseFloat(_0x1efax21));_0x1efax44[_0xbd52[84]](_0xbd52[27],sql.Decimal(10,2),parseFloat(_0x1efax22));_0x1efax44[_0xbd52[84]](_0xbd52[40],sql.DateTimeOffset, new Date());_0x1efax44[_0xbd52[92]](_0xbd52[93],function(_0x1efax43,_0x1efax46){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}})}})}function saveConnectionStatusToDatabase(_0x1efax3b,_0x1efax3c,_0x1efax4a){sql[_0xbd52[13]](sqlConfig,function(_0x1efax43){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}else {var _0x1efax44= new sql.Request();_0x1efax44[_0xbd52[84]](_0xbd52[19],sql.VarChar,_0x1efax3b);_0x1efax44[_0xbd52[84]](_0xbd52[20],sql.VarChar,_0x1efax3c);_0x1efax44[_0xbd52[84]](_0xbd52[94],sql.Bit,_0x1efax4a);_0x1efax44[_0xbd52[84]](_0xbd52[40],sql.DateTimeOffset, new Date());_0x1efax44[_0xbd52[92]](_0xbd52[95],function(_0x1efax43,_0x1efax46){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}})}})}function deleteDataAfter10days(){sql[_0xbd52[13]](sqlConfig,function(_0x1efax43){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}else {var _0x1efax44= new sql.Request();let _0x1efax31=moment()[_0xbd52[36]](10,_0xbd52[62]);let _0x1efax4c= new Date(_0x1efax31);_0x1efax44[_0xbd52[84]](_0xbd52[96],sql.DateTimeOffset,_0x1efax4c);_0x1efax44[_0xbd52[92]](_0xbd52[97],function(_0x1efax43,_0x1efax46){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}});_0x1efax44[_0xbd52[92]](_0xbd52[98],function(_0x1efax43,_0x1efax46){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)}});_0x1efax44[_0xbd52[92]](_0xbd52[99],function(_0x1efax43,_0x1efax46){if(_0x1efax43){console[_0xbd52[31]](_0x1efax43)};console[_0xbd52[31]](_0xbd52[100])})}});sql[_0xbd52[103]](_0xbd52[101],(_0x1efax43)=>{console[_0xbd52[31]](_0xbd52[102],_0x1efax43)})}async function readOPCUA1(){try{const _0x1efax4e={endpoint_must_exist:false};const _0x1efax4f=OPCUAClient[_0xbd52[104]](_0x1efax4e);_0x1efax4f[_0xbd52[103]](_0xbd52[105],(_0x1efax50,_0x1efax51)=>{console[_0xbd52[31]](_0xbd52[106],_0x1efax50,_0xbd52[107],_0x1efax51,_0xbd52[108])});_0x1efax4f[_0xbd52[103]](_0xbd52[109],()=>{console[_0xbd52[31]](_0xbd52[110]);opc_server[0][_0xbd52[25]][4][_0xbd52[24]]= 0});_0x1efax4f[_0xbd52[103]](_0xbd52[111],()=>{console[_0xbd52[31]](_0xbd52[112]);readOPCUA1()});_0x1efax4f[_0xbd52[103]](_0xbd52[113],()=>{console[_0xbd52[31]](_0xbd52[114]);opc_server[0][_0xbd52[25]][4][_0xbd52[24]]= 0});_0x1efax4f[_0xbd52[103]](_0xbd52[115],()=>{console[_0xbd52[31]](_0xbd52[116])});_0x1efax4f[_0xbd52[103]](_0xbd52[117],(_0x1efax43)=>{console[_0xbd52[31]](_0xbd52[118],_0x1efax43)}); await _0x1efax4f[_0xbd52[13]](process[_0xbd52[12]].FLEXY_URL);const _0x1efax52= await _0x1efax4f[_0xbd52[121]]({userName:opc_server[0][_0xbd52[119]],password:opc_server[0][_0xbd52[120]]});const _0x1efax53= await _0x1efax52[_0xbd52[122]]({maxNotificationsPerPublish:5000,publishingEnabled:true,requestedLifetimeCount:500,requestedMaxKeepAliveCount:50,requestedPublishingInterval:5000});_0x1efax53[_0xbd52[103]](_0xbd52[123],(_0x1efax54)=>{});const _0x1efax55=[];opc_server[0][_0xbd52[25]][_0xbd52[59]](function(_0x1efax56){let _0x1efax57=_0xbd52[124]+ flexy_ns+ _0xbd52[125]+ _0x1efax56[_0xbd52[126]];let _0x1efax58={attributeId:AttributeIds[_0xbd52[46]],nodeId:resolveNodeId(_0x1efax57)};_0x1efax55[_0xbd52[74]](_0x1efax58)});const _0x1efax59={discardOldest:true,queueSize:1,samplingInterval:10};const _0x1efax5a=ClientMonitoredItemGroup[_0xbd52[104]](_0x1efax53,_0x1efax55,_0x1efax59,TimestampsToReturn.Both);_0x1efax5a[_0xbd52[103]](_0xbd52[127],()=>{console[_0xbd52[31]](_0xbd52[128]);opc_server[0][_0xbd52[25]][4][_0xbd52[24]]= 1});_0x1efax5a[_0xbd52[103]](_0xbd52[129],(_0x1efax5b,_0x1efax5c,_0x1efax5d)=>{let _0x1efax5e=_0x1efax5b[_0xbd52[131]][_0xbd52[130]][_0xbd52[24]];let _0x1efax5f=_0x1efax5c[_0xbd52[132]].toString();var _0x1efax60=opc_server[0][_0xbd52[25]][_0xbd52[133]](function(_0x1efax61,_0x1efax62){return _0x1efax61[_0xbd52[126]]=== _0x1efax5e});opc_server[0][_0xbd52[25]][_0x1efax60][_0xbd52[24]]= parseFloat(_0x1efax5c[_0xbd52[24]][_0xbd52[24]][_0xbd52[48]](2));opc_server[0][_0xbd52[25]][_0x1efax60][_0xbd52[134]]=  new Date(_0x1efax5f);opc_server[0][_0xbd52[40]]=  new Date(_0x1efax5f);opc_server[0][_0xbd52[25]][4][_0xbd52[24]]= 1;interval_flag= 1}); await  new Promise((_0x1efax63)=>setTimeout(_0x1efax63,1000000000)); await _0x1efax5a[_0xbd52[135]](); await _0x1efax52[_0xbd52[136]](); await _0x1efax4f[_0xbd52[137]]();console[_0xbd52[31]](_0xbd52[138]);readOPCUA1()}catch(err){console[_0xbd52[31]](_0xbd52[139],err)}}function exportToCSVFile(_0x1efax16){const _0x1efax4e={fieldSeparator:_0xbd52[140],quoteStrings:_0xbd52[42],decimalSeparator:_0xbd52[141],showLabels:true,showTitle:false,title:_0xbd52[142],useTextFile:false,useBom:false,useKeysAsHeaders:false,headers:[_0xbd52[143]]};const _0x1efax65= new ExportToCsv(_0x1efax4e);const _0x1efax66=_0x1efax65[_0xbd52[144]](_0x1efax16,true);var _0x1efax67= new Date();_0x1efax67= moment(_0x1efax67)[_0xbd52[72]](_0xbd52[145]);let _0x1efax68=process[_0xbd52[12]][_0xbd52[146]]+ _0xbd52[147]+ process[_0xbd52[12]][_0xbd52[19]]+ _0xbd52[148]+ _0x1efax67+ _0xbd52[149];fs[_0xbd52[33]](_0x1efax68,_0x1efax66);let _0x1efax69=process[_0xbd52[12]][_0xbd52[150]]+ _0xbd52[151]+ moment()[_0xbd52[72]](_0xbd52[152]);let _0x1efax6a=_0x1efax69+ _0xbd52[151]+ moment()[_0xbd52[72]](_0xbd52[153]);let _0x1efax6b=_0x1efax6a+ _0xbd52[151]+ moment()[_0xbd52[72]](_0xbd52[154]);let _0x1efax6c=_0x1efax6b+ _0xbd52[151]+ moment()[_0xbd52[72]](_0xbd52[155]);const _0x1efax6d=mkdirp[_0xbd52[156]](_0x1efax69);const _0x1efax6e=mkdirp[_0xbd52[156]](_0x1efax6a);const _0x1efax6f=mkdirp[_0xbd52[156]](_0x1efax6b);const _0x1efax70=mkdirp[_0xbd52[156]](_0x1efax6c);let _0x1efax71=_0x1efax6c+ _0xbd52[147]+ process[_0xbd52[12]][_0xbd52[19]]+ _0xbd52[148]+ _0x1efax67+ _0xbd52[149];fs[_0xbd52[33]](_0x1efax71,_0x1efax66)}