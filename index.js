var _0xce2c=["\x63\x6F\x6E\x66\x69\x67","\x64\x6F\x74\x65\x6E\x76","\x6D\x6F\x6D\x65\x6E\x74","\x66\x73","\x6D\x6B\x64\x69\x72\x70","\x64\x61\x74\x65\x66\x6F\x72\x6D\x61\x74","\x45\x78\x70\x6F\x72\x74\x54\x6F\x43\x73\x76","\x65\x78\x70\x6F\x72\x74\x2D\x74\x6F\x2D\x63\x73\x76","\x6D\x6F\x6E\x67\x6F\x6F\x73\x65","\x6D\x73\x73\x71\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x72\x61\x77\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x2E\x2F\x6D\x6F\x64\x65\x6C\x73\x2F\x63\x61\x6C\x63\x64\x61\x74\x61\x2E\x6D\x6F\x64\x65\x6C","\x65\x6E\x76","\x63\x6F\x6E\x6E\x65\x63\x74","\x75\x73\x65\x46\x69\x6E\x64\x41\x6E\x64\x4D\x6F\x64\x69\x66\x79","\x73\x65\x74","\x2E\x2F\x63\x6F\x6E\x66\x69\x67\x2F\x73\x71\x6C\x2E\x6A\x73","\x6E\x6F\x64\x65\x2D\x6F\x70\x63\x75\x61\x2D\x63\x6C\x69\x65\x6E\x74","\x46\x4C\x45\x58\x59\x5F\x4E\x61\x6D\x65\x73\x70\x61\x63\x65","\x73\x69\x74\x65\x5F\x69\x64","\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65","\x75\x73\x65\x72\x2F\x65\x64\x69\x74\x2E\x74\x78\x74","\x72\x65\x61\x64\x46\x69\x6C\x65\x53\x79\x6E\x63","\x70\x61\x72\x73\x65","\x76\x61\x6C\x75\x65","\x64\x61\x74\x61","\x74\x69\x65\x72\x31","\x74\x69\x65\x72\x32","\x61\x76\x72\x54\x69\x65\x72\x31","\x61\x76\x72\x54\x69\x65\x72\x32","\x75\x73\x65\x72\x20\x6D\x6F\x64\x69\x66\x69\x65\x64\x20","\x6C\x6F\x67","\x7B\x22\x74\x69\x65\x72\x31\x22\x3A\x20\x30\x2C\x20\x22\x74\x69\x65\x72\x32\x22\x3A\x20\x30\x2C\x20\x22\x61\x76\x72\x54\x69\x65\x72\x31\x22\x3A\x20\x30\x2C\x20\x22\x61\x76\x72\x54\x69\x65\x72\x32\x22\x3A\x30\x20\x7D","\x77\x72\x69\x74\x65\x46\x69\x6C\x65\x53\x79\x6E\x63","\x75\x73\x65\x72\x20\x6D\x6F\x64\x69\x66\x69\x65\x64","\x6D\x69\x6E\x75\x74\x65\x73","\x73\x75\x62\x74\x72\x61\x63\x74","\x75\x70\x64\x61\x74\x65\x4D\x61\x6E\x79","\x69\x6E\x73\x65\x72\x74\x4D\x61\x6E\x79","\x73\x74\x72\x69\x6E\x67\x69\x66\x79","\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74","\x6E\x6F\x74\x65","","\x6D\x6D\x2F\x64\x64\x2F\x79\x79\x79\x79\x20\x48\x48\x3A\x4D\x4D","\x54\x69\x6D\x65\x53\x74\x61\x6D\x70","\x54\x61\x67\x6E\x61\x6D\x65","\x56\x61\x6C\x75\x65","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x51\x2D\x47\x4E\x32\x31","\x74\x6F\x46\x69\x78\x65\x64","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x51\x2D\x47\x4E\x32\x32","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x46\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x50\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x54\x54\x2D\x47\x4E\x32\x31","\x4D\x59\x39\x39\x39\x39\x35\x32\x3A\x4D\x45\x54\x54\x55\x42\x45\x2E\x43\x4F\x4D\x4D\x55\x4E\x49\x43\x41\x54\x49\x4F\x4E","\x45\x72\x72\x6F\x72\x20\x73\x61\x76\x65\x20\x64\x61\x74\x61\x20\x74\x6F\x20\x4C\x6F\x63\x61\x6C\x20\x64\x61\x74\x61","\x66\x69\x6E\x64","\x63\x6F\x75\x6E\x74\x44\x6F\x63\x75\x6D\x65\x6E\x74\x73","\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E","\x66\x6F\x72\x45\x61\x63\x68","\x61\x76\x72\x46\x6C\x6F\x77","\x61\x76\x72\x5F\x66\x6C\x6F\x77","\x64\x61\x79\x73","\x64\x65\x6C\x65\x74\x65\x4D\x61\x6E\x79","\x44\x65\x6C\x65\x74\x65\x64\x20\x64\x61\x74\x61\x20\x62\x65\x66\x6F\x72\x65\x20","\x54\x6F\x74\x61\x6C\x20\x72\x65\x63\x6F\x72\x64\x20\x64\x65\x6C\x65\x74\x65\x64\x20\x3D\x20","\x64\x65\x6C\x65\x74\x65\x64\x43\x6F\x75\x6E\x74","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x31","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x32","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x33","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x34","\x46\x4C\x45\x58\x59\x5F\x54\x61\x67\x6E\x61\x6D\x65\x35","\x66\x6F\x72\x6D\x61\x74","\x6C\x6F\x63\x61\x6C","\x70\x75\x73\x68","\x69\x70","\x70\x6F\x72\x74","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x55\x53\x45\x52\x4E\x41\x4D\x45","\x4F\x50\x43\x5F\x53\x45\x52\x56\x45\x52\x5F\x50\x41\x53\x53\x57\x4F\x52\x44","\x6C\x69\x6D\x69\x74","\x73\x6F\x72\x74","\x66\x69\x6E\x64\x4F\x6E\x65","\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A\x2A","\x46\x69\x72\x73\x74\x20\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x20","\x69\x6E\x70\x75\x74","\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65","\x70\x72\x65\x73\x73\x75\x72\x65","\x66\x6C\x6F\x77","\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65\x2C\x20\x70\x72\x65\x73\x73\x75\x72\x65\x2C\x20\x66\x6C\x6F\x77\x2C\x20\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77\x2C","\x20\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x29\x20\x56\x41\x4C\x55\x45\x53\x20","\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x74\x65\x6D\x70\x65\x72\x61\x74\x75\x72\x65\x2C\x40\x70\x72\x65\x73\x73\x75\x72\x65\x2C\x20\x40\x66\x6C\x6F\x77\x2C\x20\x40\x63\x6F\x6D\x70\x65\x6E\x73\x61\x74\x65\x64\x66\x6C\x6F\x77\x2C\x20\x40\x69\x6E\x66\x6F\x72\x6D\x61\x74\x69\x6F\x6E\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x29","\x71\x75\x65\x72\x79","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x32\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x61\x76\x72\x66\x6C\x6F\x77\x2C\x20\x74\x69\x65\x72\x31\x2C\x20\x74\x69\x65\x72\x32\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x61\x76\x72\x46\x6C\x6F\x77\x2C\x20\x40\x74\x69\x65\x72\x31\x2C\x20\x40\x74\x69\x65\x72\x32\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29","\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74","\x49\x4E\x53\x45\x52\x54\x20\x49\x4E\x54\x4F\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x53\x74\x61\x74\x75\x73\x20\x28\x73\x69\x74\x65\x5F\x69\x64\x2C\x20\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74\x2C\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29\x20\x56\x41\x4C\x55\x45\x53\x20\x28\x40\x73\x69\x74\x65\x5F\x69\x64\x2C\x40\x73\x69\x74\x65\x5F\x6E\x61\x6D\x65\x2C\x20\x40\x69\x73\x5F\x63\x6F\x6E\x6E\x65\x63\x74\x2C\x20\x40\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x29","\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x31\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x32\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x45\x4C\x45\x54\x45\x20\x46\x52\x4F\x4D\x20\x44\x61\x74\x61\x4C\x6F\x67\x67\x65\x72\x53\x74\x61\x74\x75\x73\x20\x57\x48\x45\x52\x45\x20\x63\x72\x65\x61\x74\x65\x64\x5F\x61\x74\x20\x3C\x20\x40\x62\x65\x66\x6F\x72\x65\x64\x61\x79","\x44\x65\x6C\x65\x74\x65\x64\x20\x64\x61\x74\x61\x20\x62\x65\x66\x6F\x72\x65\x20\x31\x30\x20\x64\x61\x79\x73","\x65\x72\x72\x6F\x72","\x53\x51\x4C\x20\x68\x61\x73\x20\x69\x73\x73\x75\x65\x20","\x6F\x6E","\x63\x72\x65\x61\x74\x65","\x62\x61\x63\x6B\x6F\x66\x66","\x42\x61\x63\x6B\x6F\x66\x66\x20","\x20\x6E\x65\x78\x74\x20\x61\x74\x74\x65\x6D\x70\x74\x20\x69\x6E\x20","\x6D\x73","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x6C\x6F\x73\x74","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x6C\x6F\x73\x74","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x72\x65\x65\x73\x74\x61\x62\x6C\x69\x73\x68\x65\x64","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x72\x65\x2D\x65\x73\x74\x61\x62\x6C\x69\x73\x68\x65\x64","\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x5F\x66\x61\x69\x6C\x65\x64","\x43\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x66\x61\x69\x6C\x65\x64","\x73\x74\x61\x72\x74\x5F\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x53\x74\x61\x72\x74\x69\x6E\x67\x20\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x61\x66\x74\x65\x72\x5F\x72\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E","\x41\x66\x74\x65\x72\x20\x52\x65\x63\x6F\x6E\x6E\x65\x63\x74\x69\x6F\x6E\x20\x65\x76\x65\x6E\x74\x20\x3D\x3E","\x75\x73\x65\x72\x6E\x61\x6D\x65","\x70\x61\x73\x73\x77\x6F\x72\x64","\x63\x72\x65\x61\x74\x65\x53\x65\x73\x73\x69\x6F\x6E","\x63\x72\x65\x61\x74\x65\x53\x75\x62\x73\x63\x72\x69\x70\x74\x69\x6F\x6E\x32","\x73\x74\x61\x72\x74\x65\x64","\x6E\x73\x3D","\x3B\x73\x3D","\x6E\x61\x6D\x65","\x69\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64","\x4F\x50\x43\x20\x55\x41\x20\x49\x6E\x69\x74\x69\x61\x6C\x69\x7A\x65\x64\x21\x20\x43\x6F\x6E\x6E\x65\x63\x74\x20\x74\x6F\x20\x46\x6C\x65\x78\x79\x20\x73\x75\x63\x63\x65\x73\x73\x66\x75\x6C\x6C\x79","\x63\x68\x61\x6E\x67\x65\x64","\x6E\x6F\x64\x65\x49\x64","\x69\x74\x65\x6D\x54\x6F\x4D\x6F\x6E\x69\x74\x6F\x72","\x73\x65\x72\x76\x65\x72\x54\x69\x6D\x65\x73\x74\x61\x6D\x70","\x66\x69\x6E\x64\x49\x6E\x64\x65\x78","\x74\x69\x6D\x65","\x74\x65\x72\x6D\x69\x6E\x61\x74\x65","\x63\x6C\x6F\x73\x65","\x64\x69\x73\x63\x6F\x6E\x6E\x65\x63\x74","\x44\x6F\x6E\x65\x20\x21","\x45\x72\x72\x6F\x72","\x2C","\x2E","\x5B\x44\x61\x74\x61\x5D","\x5B\x44\x41\x54\x41\x5D","\x67\x65\x6E\x65\x72\x61\x74\x65\x43\x73\x76","\x59\x59\x59\x59\x4D\x4D\x44\x44\x5F\x48\x48\x6D\x6D\x73\x73","\x43\x53\x56\x5F\x45\x58\x50\x4F\x52\x54\x5F\x50\x41\x54\x48","\x5C\x44\x61\x74\x61\x5F","\x5F","\x2E\x63\x73\x76","\x43\x53\x56\x5F\x42\x41\x43\x4B\x55\x50\x5F\x50\x41\x54\x48","\x5C","\x59\x59\x59\x59","\x59\x59\x59\x59\x5F\x4D\x4D","\x59\x59\x59\x59\x5F\x4D\x4D\x5F\x44\x44","\x59\x59\x59\x59\x5F\x4D\x4D\x5F\x44\x44\x5F\x48\x48","\x73\x79\x6E\x63"];require(_0xce2c[1])[_0xce2c[0]]();var moment=require(_0xce2c[2]);var fs=require(_0xce2c[3]);const mkdirp=require(_0xce2c[4]);var dateFormat=require(_0xce2c[5]);const ExportToCsv=require(_0xce2c[7])[_0xce2c[6]];var mongoose=require(_0xce2c[8]);var sql=require(_0xce2c[9]);var RawData=require(_0xce2c[10]);var CalcData=require(_0xce2c[11]);mongoose[_0xce2c[13]](process[_0xce2c[12]].MONGO_URL,{useNewUrlParser:true,useUnifiedTopology:true});mongoose[_0xce2c[15]](_0xce2c[14],false);const sqlConfig=require(_0xce2c[16]);const {OPCUAClient,resolveNodeId,AttributeIds,ClientMonitoredItemGroup,TimestampsToReturn}=require(_0xce2c[17]);let TIER_2_BENCHMARK=parseFloat(process[_0xce2c[12]].TIER_2_BENCHMARK);let TIME_INTERVAL_GETDATA=parseInt(process[_0xce2c[12]].TIME_INTERVAL_GETDATA)* 1000;let TIME_INTERVAL_CALCDATA=parseInt(process[_0xce2c[12]].TIME_INTERVAL_CALCDATA)* 1000;let TIME_INTERVAL_REMOVE_DATA=parseInt(process[_0xce2c[12]].TIME_INTERVAL_REMOVE_DATA)* 86400000;let flexy_ns=process[_0xce2c[12]][_0xce2c[18]];var opc_server=[];var opc_server_avr=[];var interval_flag=0;async function run(){ await readFirstConfig(); await setTimeout(function(){},2000); await setInterval(async function(){let _0xb480x14=opc_server[0][_0xce2c[19]];let _0xb480x15=opc_server[0][_0xce2c[20]];if(interval_flag){const _0xb480x16= await fs[_0xce2c[22]](_0xce2c[21]);let _0xb480x17=_0xb480x16.toString();let _0xb480x18=JSON[_0xce2c[23]](_0xb480x17);let _0xb480x19=opc_server[0][_0xce2c[25]][3][_0xce2c[24]];let _0xb480x1a=opc_server[0][_0xce2c[26]];let _0xb480x1b=opc_server[0][_0xce2c[27]];if(_0xb480x18[_0xce2c[26]]> 0|| _0xb480x18[_0xce2c[27]]> 0|| _0xb480x18[_0xce2c[28]]> 0|| _0xb480x18[_0xce2c[29]]> 0){console[_0xce2c[31]](_0xce2c[30],_0xb480x18[_0xce2c[26]],_0xb480x18[_0xce2c[27]],_0xb480x18[_0xce2c[28]],_0xb480x18[_0xce2c[29]]);fs[_0xce2c[33]](_0xce2c[21],_0xce2c[32]);_0xb480x1a= _0xb480x18[_0xce2c[26]];_0xb480x1b= _0xb480x18[_0xce2c[27]];let _0xb480x1c={site_id:opc_server[0][_0xce2c[19]],site_name:opc_server[0][_0xce2c[20]],information:opc_server[0][_0xce2c[25]],tier1:_0xb480x18[_0xce2c[26]],tier2:_0xb480x18[_0xce2c[27]],created_at: new Date(),flag:1,note:_0xce2c[34]};let _0xb480x1d=moment()[_0xce2c[36]](20,_0xce2c[35]);let _0xb480x1e=moment();let _0xb480x1f={created_at:{$gte:_0xb480x1d},tier1:{$gt:0}}; await RawData[_0xce2c[37]](_0xb480x1f,{$set:{flag:0}}); await RawData[_0xce2c[38]](_0xb480x1c);insert_data(_0xb480x14,_0xb480x15,opc_server[0][_0xce2c[25]][0][_0xce2c[24]],opc_server[0][_0xce2c[25]][2][_0xce2c[24]],opc_server[0][_0xce2c[25]][1][_0xce2c[24]],opc_server[0][_0xce2c[25]][3][_0xce2c[24]],JSON[_0xce2c[39]](opc_server[0][_0xce2c[25]]),_0xb480x18[_0xce2c[26]],_0xb480x18[_0xce2c[27]],opc_server[0][_0xce2c[40]]);opc_server_avr[_0xce2c[26]]= _0xb480x18[_0xce2c[28]];opc_server_avr[_0xce2c[27]]= _0xb480x18[_0xce2c[29]];opc_server_avr[_0xce2c[40]]=  new Date();let _0xb480x20=opc_server_avr;_0xb480x20[_0xce2c[41]]= _0xce2c[34]; await CalcData[_0xce2c[38]](_0xb480x20);_0xb480x20[_0xce2c[41]]= _0xce2c[42]};let _0xb480x21,_0xb480x22;if(_0xb480x19> TIER_2_BENCHMARK){_0xb480x21= TIER_2_BENCHMARK/ 60+ _0xb480x1a;_0xb480x22= (_0xb480x19- TIER_2_BENCHMARK)/ 60+ _0xb480x1b}else {_0xb480x21= _0xb480x19/ 60+ _0xb480x1a;_0xb480x22= 0+ _0xb480x1b};opc_server[0][_0xce2c[26]]= _0xb480x21;opc_server[0][_0xce2c[27]]= _0xb480x22;insert_data(_0xb480x14,_0xb480x15,opc_server[0][_0xce2c[25]][0][_0xce2c[24]],opc_server[0][_0xce2c[25]][2][_0xce2c[24]],opc_server[0][_0xce2c[25]][1][_0xce2c[24]],opc_server[0][_0xce2c[25]][3][_0xce2c[24]],JSON[_0xce2c[39]](opc_server[0][_0xce2c[25]]),_0xb480x21,_0xb480x22,opc_server[0][_0xce2c[40]]);let _0xb480x1c={site_id:opc_server[0][_0xce2c[19]],site_name:opc_server[0][_0xce2c[20]],information:opc_server[0][_0xce2c[25]],tier1:opc_server[0][_0xce2c[26]],tier2:opc_server[0][_0xce2c[27]],created_at: new Date(),flag:1};let _0xb480x23=dateFormat(opc_server[0][_0xce2c[40]],_0xce2c[43]);let _0xb480x24=[{TimeStamp:_0xce2c[44],Tagname:_0xce2c[45],Value:_0xce2c[46]},{TimeStamp:_0xb480x23,Tagname:_0xce2c[47],Value:_0xb480x21[_0xce2c[48]](2)},{TimeStamp:_0xb480x23,Tagname:_0xce2c[49],Value:_0xb480x22[_0xce2c[48]](2)},{TimeStamp:_0xb480x23,Tagname:_0xce2c[50],Value:opc_server[0][_0xce2c[25]][1][_0xce2c[24]]},{TimeStamp:_0xb480x23,Tagname:_0xce2c[51],Value:opc_server[0][_0xce2c[25]][2][_0xce2c[24]]},{TimeStamp:_0xb480x23,Tagname:_0xce2c[52],Value:opc_server[0][_0xce2c[25]][0][_0xce2c[24]]},{TimeStamp:_0xb480x23,Tagname:_0xce2c[53],Value:opc_server[0][_0xce2c[25]][4][_0xce2c[24]]}];exportToCSVFile(_0xb480x24); await RawData[_0xce2c[38]](_0xb480x1c,function(_0xb480x25,_0xb480x26){if(_0xb480x25){console[_0xce2c[31]](_0xce2c[54])}})}},TIME_INTERVAL_GETDATA); await setInterval(async function(){if(interval_flag){let _0xb480x1d=moment()[_0xce2c[36]](15,_0xce2c[35]);let _0xb480x1e=moment();let _0xb480x1f={created_at:{$gte:_0xb480x1d,$lte:_0xb480x1e},tier1:{$gt:0}};let _0xb480x27= await RawData[_0xce2c[55]](_0xb480x1f);let _0xb480x28= await RawData[_0xce2c[56]](_0xb480x1f);let _0xb480x29=0;_0xb480x27[_0xce2c[58]](function(_0xb480x2a){_0xb480x29= _0xb480x29+ parseFloat(_0xb480x2a[_0xce2c[57]][3][_0xce2c[24]])});let _0xb480x2b=0;if(_0xb480x28> 0){_0xb480x2b= _0xb480x29/ _0xb480x28};let _0xb480x2c=opc_server_avr[_0xce2c[26]];let _0xb480x2d=opc_server_avr[_0xce2c[27]];let _0xb480x2e,_0xb480x2f;if(_0xb480x2b> TIER_2_BENCHMARK){_0xb480x2e= TIER_2_BENCHMARK/ 60+ _0xb480x2c;_0xb480x2f= (_0xb480x2b- TIER_2_BENCHMARK)/ 60+ _0xb480x2d}else {_0xb480x2e= _0xb480x2b/ 60+ _0xb480x2c;_0xb480x2f= 0+ _0xb480x2d};opc_server_avr[_0xce2c[26]]= _0xb480x2e;opc_server_avr[_0xce2c[27]]= _0xb480x2f;opc_server_avr[_0xce2c[40]]=  new Date();opc_server_avr[_0xce2c[59]]= _0xb480x2b;let _0xb480x30=opc_server_avr;_0xb480x30[_0xce2c[60]]= opc_server_avr[_0xce2c[59]]; await CalcData[_0xce2c[38]](_0xb480x30,function(_0xb480x25,_0xb480x26){if(_0xb480x25){console[_0xce2c[31]](_0xce2c[54])}}); await saveAvrDataToDatabase(opc_server[0][_0xce2c[19]],opc_server[0][_0xce2c[20]],opc_server_avr[_0xce2c[59]],opc_server_avr[_0xce2c[26]],opc_server_avr[_0xce2c[27]])}},TIME_INTERVAL_CALCDATA); await setInterval(async function(){let _0xb480x31=moment()[_0xce2c[36]](10,_0xce2c[61]);const _0xb480x32= await RawData[_0xce2c[62]]({created_at:{$lte:_0xb480x31}});console[_0xce2c[31]](_0xce2c[63],_0xb480x31,_0xce2c[64],_0xb480x32[_0xce2c[65]]);deleteDataAfter10days()},TIME_INTERVAL_REMOVE_DATA); await setInterval(async function(){saveConnectionStatusToDatabase(opc_server[0][_0xce2c[19]],opc_server[0][_0xce2c[20]],opc_server[0][_0xce2c[25]][4][_0xce2c[24]])},TIME_INTERVAL_GETDATA); await readOPCUA1()}run();async function readFirstConfig(){let _0xb480x34=[];let _0xb480x35=[process[_0xce2c[12]][_0xce2c[66]],process[_0xce2c[12]][_0xce2c[67]],process[_0xce2c[12]][_0xce2c[68]],process[_0xce2c[12]][_0xce2c[69]],process[_0xce2c[12]][_0xce2c[70]]];for(const _0xb480x36 of _0xb480x35){_0xb480x34[_0xce2c[73]]({name:_0xb480x36,value:0,time:moment()[_0xce2c[72]]()[_0xce2c[71]]()})};let _0xb480x37={id:1,site_id:process[_0xce2c[12]][_0xce2c[19]],site_name:process[_0xce2c[12]][_0xce2c[20]],ip:process[_0xce2c[12]][_0xce2c[74]],port:parseInt(process[_0xce2c[12]][_0xce2c[75]]),username:process[_0xce2c[12]][_0xce2c[76]],password:process[_0xce2c[12]][_0xce2c[77]],data:_0xb480x34,tier1:0,tier2:0,created_at: new Date()};opc_server_avr= {avrFlow:0,tier1:0,tier2:0};let _0xb480x38= await RawData[_0xce2c[80]]()[_0xce2c[79]]({_id:-1})[_0xce2c[78]](1);if(_0xb480x38){_0xb480x37[_0xce2c[26]]= _0xb480x38[_0xce2c[26]];_0xb480x37[_0xce2c[27]]= _0xb480x38[_0xce2c[27]]}else {_0xb480x37[_0xce2c[26]]= parseFloat(process[_0xce2c[12]].START_TIER_1);_0xb480x37[_0xce2c[27]]= parseFloat(process[_0xce2c[12]].START_TIER_2)};let _0xb480x39= await CalcData[_0xce2c[80]]()[_0xce2c[79]]({_id:-1})[_0xce2c[78]](1);if(_0xb480x39){opc_server_avr[_0xce2c[26]]= _0xb480x39[_0xce2c[26]];opc_server_avr[_0xce2c[27]]= _0xb480x39[_0xce2c[27]]}else {opc_server_avr[_0xce2c[26]]= parseFloat(process[_0xce2c[12]].START_AVR_TIER_1);opc_server_avr[_0xce2c[27]]= parseFloat(process[_0xce2c[12]].START_AVR_TIER_2)};opc_server[_0xce2c[73]](_0xb480x37);console[_0xce2c[31]](_0xce2c[81]);console[_0xce2c[31]](_0xce2c[82],opc_server,opc_server_avr);return}function insert_data(_0xb480x3b,_0xb480x3c,_0xb480x3d,_0xb480x3e,_0xb480x3f,_0xb480x40,_0xb480x41,_0xb480x21,_0xb480x22,_0xb480x42){sql[_0xce2c[13]](sqlConfig,function(_0xb480x43){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}else {var _0xb480x44= new sql.Request();_0xb480x44[_0xce2c[83]](_0xce2c[19],sql.VarChar,_0xb480x3b);_0xb480x44[_0xce2c[83]](_0xce2c[20],sql.VarChar,_0xb480x3c);_0xb480x44[_0xce2c[83]](_0xce2c[57],sql.VarChar,_0xb480x41);_0xb480x44[_0xce2c[83]](_0xce2c[40],sql.DateTimeOffset,_0xb480x42);_0xb480x44[_0xce2c[83]](_0xce2c[84],sql.Decimal(10,2),parseFloat(_0xb480x3d+ 0.0));_0xb480x44[_0xce2c[83]](_0xce2c[85],sql.Decimal(10,2),parseFloat(_0xb480x3e+ 0.0));_0xb480x44[_0xce2c[83]](_0xce2c[86],sql.Decimal(10,2),parseFloat(_0xb480x3f+ 0.0));_0xb480x44[_0xce2c[83]](_0xce2c[87],sql.Decimal(10,2),parseFloat(_0xb480x40+ 0.0));_0xb480x44[_0xce2c[83]](_0xce2c[26],sql.Decimal(10,2),parseFloat(_0xb480x21));_0xb480x44[_0xce2c[83]](_0xce2c[27],sql.Decimal(10,2),parseFloat(_0xb480x22));let _0xb480x45=_0xce2c[88]+ _0xce2c[89]+ _0xce2c[90];_0xb480x44[_0xce2c[91]](_0xb480x45,function(_0xb480x43,_0xb480x46){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}})}})}function saveAvrDataToDatabase(_0xb480x3b,_0xb480x3c,_0xb480x48,_0xb480x21,_0xb480x22){sql[_0xce2c[13]](sqlConfig,function(_0xb480x43){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}else {var _0xb480x44= new sql.Request();_0xb480x44[_0xce2c[83]](_0xce2c[19],sql.VarChar,_0xb480x3b);_0xb480x44[_0xce2c[83]](_0xce2c[20],sql.VarChar,_0xb480x3c);_0xb480x44[_0xce2c[83]](_0xce2c[59],sql.Decimal(10,2),parseFloat(_0xb480x48));_0xb480x44[_0xce2c[83]](_0xce2c[26],sql.Decimal(10,2),parseFloat(_0xb480x21));_0xb480x44[_0xce2c[83]](_0xce2c[27],sql.Decimal(10,2),parseFloat(_0xb480x22));_0xb480x44[_0xce2c[83]](_0xce2c[40],sql.DateTimeOffset, new Date());_0xb480x44[_0xce2c[91]](_0xce2c[92],function(_0xb480x43,_0xb480x46){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}})}})}function saveConnectionStatusToDatabase(_0xb480x3b,_0xb480x3c,_0xb480x4a){sql[_0xce2c[13]](sqlConfig,function(_0xb480x43){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}else {var _0xb480x44= new sql.Request();_0xb480x44[_0xce2c[83]](_0xce2c[19],sql.VarChar,_0xb480x3b);_0xb480x44[_0xce2c[83]](_0xce2c[20],sql.VarChar,_0xb480x3c);_0xb480x44[_0xce2c[83]](_0xce2c[93],sql.Bit,_0xb480x4a);_0xb480x44[_0xce2c[83]](_0xce2c[40],sql.DateTimeOffset, new Date());_0xb480x44[_0xce2c[91]](_0xce2c[94],function(_0xb480x43,_0xb480x46){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}})}})}function deleteDataAfter10days(){sql[_0xce2c[13]](sqlConfig,function(_0xb480x43){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}else {var _0xb480x44= new sql.Request();let _0xb480x31=moment()[_0xce2c[36]](10,_0xce2c[61]);let _0xb480x4c= new Date(_0xb480x31);_0xb480x44[_0xce2c[83]](_0xce2c[95],sql.DateTimeOffset,_0xb480x4c);_0xb480x44[_0xce2c[91]](_0xce2c[96],function(_0xb480x43,_0xb480x46){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}});_0xb480x44[_0xce2c[91]](_0xce2c[97],function(_0xb480x43,_0xb480x46){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)}});_0xb480x44[_0xce2c[91]](_0xce2c[98],function(_0xb480x43,_0xb480x46){if(_0xb480x43){console[_0xce2c[31]](_0xb480x43)};console[_0xce2c[31]](_0xce2c[99])})}});sql[_0xce2c[102]](_0xce2c[100],(_0xb480x43)=>{console[_0xce2c[31]](_0xce2c[101],_0xb480x43)})}async function readOPCUA1(){try{const _0xb480x4e={endpoint_must_exist:false};const _0xb480x4f=OPCUAClient[_0xce2c[103]](_0xb480x4e);_0xb480x4f[_0xce2c[102]](_0xce2c[104],(_0xb480x50,_0xb480x51)=>{console[_0xce2c[31]](_0xce2c[105],_0xb480x50,_0xce2c[106],_0xb480x51,_0xce2c[107])});_0xb480x4f[_0xce2c[102]](_0xce2c[108],()=>{console[_0xce2c[31]](_0xce2c[109]);opc_server[0][_0xce2c[25]][4][_0xce2c[24]]= 0});_0xb480x4f[_0xce2c[102]](_0xce2c[110],()=>{console[_0xce2c[31]](_0xce2c[111]);readOPCUA1()});_0xb480x4f[_0xce2c[102]](_0xce2c[112],()=>{console[_0xce2c[31]](_0xce2c[113]);opc_server[0][_0xce2c[25]][4][_0xce2c[24]]= 0});_0xb480x4f[_0xce2c[102]](_0xce2c[114],()=>{console[_0xce2c[31]](_0xce2c[115])});_0xb480x4f[_0xce2c[102]](_0xce2c[116],(_0xb480x43)=>{console[_0xce2c[31]](_0xce2c[117],_0xb480x43)}); await _0xb480x4f[_0xce2c[13]](process[_0xce2c[12]].FLEXY_URL);const _0xb480x52= await _0xb480x4f[_0xce2c[120]]({userName:opc_server[0][_0xce2c[118]],password:opc_server[0][_0xce2c[119]]});const _0xb480x53= await _0xb480x52[_0xce2c[121]]({maxNotificationsPerPublish:5000,publishingEnabled:true,requestedLifetimeCount:500,requestedMaxKeepAliveCount:50,requestedPublishingInterval:5000});_0xb480x53[_0xce2c[102]](_0xce2c[122],(_0xb480x54)=>{});const _0xb480x55=[];opc_server[0][_0xce2c[25]][_0xce2c[58]](function(_0xb480x56){let _0xb480x57=_0xce2c[123]+ flexy_ns+ _0xce2c[124]+ _0xb480x56[_0xce2c[125]];let _0xb480x58={attributeId:AttributeIds[_0xce2c[46]],nodeId:resolveNodeId(_0xb480x57)};_0xb480x55[_0xce2c[73]](_0xb480x58)});const _0xb480x59={discardOldest:true,queueSize:1,samplingInterval:10};const _0xb480x5a=ClientMonitoredItemGroup[_0xce2c[103]](_0xb480x53,_0xb480x55,_0xb480x59,TimestampsToReturn.Both);_0xb480x5a[_0xce2c[102]](_0xce2c[126],()=>{console[_0xce2c[31]](_0xce2c[127]);opc_server[0][_0xce2c[25]][4][_0xce2c[24]]= 1});_0xb480x5a[_0xce2c[102]](_0xce2c[128],(_0xb480x5b,_0xb480x5c,_0xb480x5d)=>{let _0xb480x5e=_0xb480x5b[_0xce2c[130]][_0xce2c[129]][_0xce2c[24]];let _0xb480x5f=_0xb480x5c[_0xce2c[131]].toString();var _0xb480x60=opc_server[0][_0xce2c[25]][_0xce2c[132]](function(_0xb480x61,_0xb480x62){return _0xb480x61[_0xce2c[125]]=== _0xb480x5e});opc_server[0][_0xce2c[25]][_0xb480x60][_0xce2c[24]]= parseFloat(_0xb480x5c[_0xce2c[24]][_0xce2c[24]][_0xce2c[48]](2));opc_server[0][_0xce2c[25]][_0xb480x60][_0xce2c[133]]=  new Date(_0xb480x5f);opc_server[0][_0xce2c[40]]=  new Date(_0xb480x5f);opc_server[0][_0xce2c[25]][4][_0xce2c[24]]= 1;interval_flag= 1}); await  new Promise((_0xb480x63)=>setTimeout(_0xb480x63,1000000000)); await _0xb480x5a[_0xce2c[134]](); await _0xb480x52[_0xce2c[135]](); await _0xb480x4f[_0xce2c[136]]();console[_0xce2c[31]](_0xce2c[137]);readOPCUA1()}catch(err){console[_0xce2c[31]](_0xce2c[138],err)}}function exportToCSVFile(_0xb480x16){const _0xb480x4e={fieldSeparator:_0xce2c[139],quoteStrings:_0xce2c[42],decimalSeparator:_0xce2c[140],showLabels:true,showTitle:false,title:_0xce2c[141],useTextFile:false,useBom:true,useKeysAsHeaders:false,headers:[_0xce2c[142],_0xce2c[42],_0xce2c[42]]};const _0xb480x65= new ExportToCsv(_0xb480x4e);const _0xb480x66=_0xb480x65[_0xce2c[143]](_0xb480x16,true);var _0xb480x67= new Date();_0xb480x67= moment(_0xb480x67)[_0xce2c[71]](_0xce2c[144]);let _0xb480x68=process[_0xce2c[12]][_0xce2c[145]]+ _0xce2c[146]+ process[_0xce2c[12]][_0xce2c[19]]+ _0xce2c[147]+ _0xb480x67+ _0xce2c[148];fs[_0xce2c[33]](_0xb480x68,_0xb480x66);let _0xb480x69=process[_0xce2c[12]][_0xce2c[149]]+ _0xce2c[150]+ moment()[_0xce2c[71]](_0xce2c[151]);let _0xb480x6a=_0xb480x69+ _0xce2c[150]+ moment()[_0xce2c[71]](_0xce2c[152]);let _0xb480x6b=_0xb480x6a+ _0xce2c[150]+ moment()[_0xce2c[71]](_0xce2c[153]);let _0xb480x6c=_0xb480x6b+ _0xce2c[150]+ moment()[_0xce2c[71]](_0xce2c[154]);const _0xb480x6d=mkdirp[_0xce2c[155]](_0xb480x69);const _0xb480x6e=mkdirp[_0xce2c[155]](_0xb480x6a);const _0xb480x6f=mkdirp[_0xce2c[155]](_0xb480x6b);const _0xb480x70=mkdirp[_0xce2c[155]](_0xb480x6c);let _0xb480x71=_0xb480x6c+ _0xce2c[146]+ process[_0xce2c[12]][_0xce2c[19]]+ _0xce2c[147]+ _0xb480x67+ _0xce2c[148];fs[_0xce2c[33]](_0xb480x71,_0xb480x66)}